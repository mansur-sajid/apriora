"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{31530:(t,e,n)=>{n.d(e,{Ay:()=>tp});var r,o=n(15933),i=n(12115);let a={data:""},s=t=>"object"==typeof window?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||a,c=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,u=/\/\*[^]*?\*\/|  +/g,h=/\n+/g,p=(t,e)=>{let n="",r="",o="";for(let i in t){let a=t[i];"@"==i[0]?"i"==i[1]?n=i+" "+a+";":r+="f"==i[1]?p(a,i):i+"{"+p(a,"k"==i[1]?"":e)+"}":"object"==typeof a?r+=p(a,e?e.replace(/([^,])+/g,t=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,e=>/&/.test(e)?e.replace(/&/g,t):t?t+" "+e:e)):i):null!=a&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=p.p?p.p(i,a):i+":"+a+";")}return n+(e&&o?e+"{"+o+"}":o)+r},f={},l=t=>{if("object"==typeof t){let e="";for(let n in t)e+=n+l(t[n]);return e}return t},d=(t,e,n,r,o)=>{let i=l(t),a=f[i]||(f[i]=(t=>{let e=0,n=11;for(;e<t.length;)n=101*n+t.charCodeAt(e++)>>>0;return"go"+n})(i));if(!f[a]){let e=i!==t?t:(t=>{let e,n,r=[{}];for(;e=c.exec(t.replace(u,""));)e[4]?r.shift():e[3]?(n=e[3].replace(h," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][e[1]]=e[2].replace(h," ").trim();return r[0]})(t);f[a]=p(o?{["@keyframes "+a]:e}:e,n?"":"."+a)}let s=n&&f.g?f.g:null;return n&&(f.g=f[a]),((t,e,n,r)=>{r?e.data=e.data.replace(r,t):-1===e.data.indexOf(t)&&(e.data=n?t+e.data:e.data+t)})(f[a],e,r,s),a},v=(t,e,n)=>t.reduce((t,r,o)=>{let i=e[o];if(i&&i.call){let t=i(n),e=t&&t.props&&t.props.className||/^go/.test(t)&&t;i=e?"."+e:t&&"object"==typeof t?t.props?"":p(t,""):!1===t?"":t}return t+r+(null==i?"":i)},"");function m(t){let e=this||{},n=t.call?t(e.p):t;return d(n.unshift?n.raw?v(n,[].slice.call(arguments,1),e.p):n.reduce((t,n)=>Object.assign(t,n&&n.call?n(e.p):n),{}):n,s(e.target),e.g,e.o,e.k)}m.bind({g:1});let g,b,y,_=m.bind({k:1});function w(t,e){let n=this||{};return function(){let r=arguments;function o(i,a){let s=Object.assign({},i),c=s.className||o.className;n.p=Object.assign({theme:b&&b()},s),n.o=/ *go\d+/.test(c),s.className=m.apply(n,r)+(c?" "+c:""),e&&(s.ref=a);let u=t;return t[0]&&(u=s.as||t,delete s.as),y&&u[0]&&y(s),g(u,s)}return e?e(o):o}}function x(){let t=(0,o._)(["\nfrom {\n  transform: scale(0) rotate(45deg);\n	opacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]);return x=function(){return t},t}function P(){let t=(0,o._)(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]);return P=function(){return t},t}function E(){let t=(0,o._)(["\nfrom {\n  transform: scale(0) rotate(90deg);\n	opacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n	opacity: 1;\n}"]);return E=function(){return t},t}function S(){let t=(0,o._)(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"]);return S=function(){return t},t}function T(){let t=(0,o._)(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]);return T=function(){return t},t}function D(){let t=(0,o._)(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"]);return D=function(){return t},t}function M(){let t=(0,o._)(["\nfrom {\n  transform: scale(0) rotate(45deg);\n	opacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n	opacity: 1;\n}"]);return M=function(){return t},t}function F(){let t=(0,o._)(["\n0% {\n	height: 0;\n	width: 0;\n	opacity: 0;\n}\n40% {\n  height: 0;\n	width: 6px;\n	opacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]);return F=function(){return t},t}function O(){let t=(0,o._)(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"]);return O=function(){return t},t}function k(){let t=(0,o._)(["\n  position: absolute;\n"]);return k=function(){return t},t}function A(){let t=(0,o._)(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]);return A=function(){return t},t}function I(){let t=(0,o._)(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]);return I=function(){return t},t}function C(){let t=(0,o._)(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"]);return C=function(){return t},t}function W(){let t=(0,o._)(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]);return W=function(){return t},t}function N(){let t=(0,o._)(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]);return N=function(){return t},t}function B(){let t=(0,o._)(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]);return B=function(){return t},t}var L=t=>"function"==typeof t,R=(t,e)=>L(t)?t(e):t,z=(()=>{let t=0;return()=>(++t).toString()})(),V=(()=>{let t;return()=>{if(void 0===t&&"u">typeof window){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),U=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,20)};case 1:return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case 2:let{toast:n}=e;return U(t,{type:+!!t.toasts.find(t=>t.id===n.id),toast:n});case 3:let{toastId:r}=e;return{...t,toasts:t.toasts.map(t=>t.id===r||void 0===r?{...t,dismissed:!0,visible:!1}:t)};case 4:return void 0===e.toastId?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let o=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(t=>({...t,pauseDuration:t.pauseDuration+o}))}}},q=[],G={toasts:[],pausedAt:void 0},Z=t=>{G=U(G,t),q.forEach(t=>{t(G)})},$={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},K=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[e,n]=j(G),r=Q(G);H(()=>(r.current!==G&&n(G),q.push(n),()=>{let t=q.indexOf(n);t>-1&&q.splice(t,1)}),[]);let o=e.toasts.map(e=>{var n,r,o;return{...t,...t[e.type],...e,removeDelay:e.removeDelay||(null==(n=t[e.type])?void 0:n.removeDelay)||(null==t?void 0:t.removeDelay),duration:e.duration||(null==(r=t[e.type])?void 0:r.duration)||(null==t?void 0:t.duration)||$[e.type],style:{...t.style,...null==(o=t[e.type])?void 0:o.style,...e.style}}});return{...e,toasts:o}},J=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return{createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:(null==n?void 0:n.id)||z()}},X=t=>(e,n)=>{let r=J(e,t,n);return Z({type:2,toast:r}),r.id},Y=(t,e)=>X("blank")(t,e);Y.error=X("error"),Y.success=X("success"),Y.loading=X("loading"),Y.custom=X("custom"),Y.dismiss=t=>{Z({type:3,toastId:t})},Y.remove=t=>Z({type:4,toastId:t}),Y.promise=(t,e,n)=>{let r=Y.loading(e.loading,{...n,...null==n?void 0:n.loading});return"function"==typeof t&&(t=t()),t.then(t=>{let o=e.success?R(e.success,t):void 0;return o?Y.success(o,{id:r,...n,...null==n?void 0:n.success}):Y.dismiss(r),t}).catch(t=>{let o=e.error?R(e.error,t):void 0;o?Y.error(o,{id:r,...n,...null==n?void 0:n.error}):Y.dismiss(r)}),t};var tt=(t,e)=>{Z({type:1,toast:{id:t,height:e}})},te=()=>{Z({type:5,time:Date.now()})},tn=new Map,tr=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(tn.has(t))return;let n=setTimeout(()=>{tn.delete(t),Z({type:4,toastId:t})},e);tn.set(t,n)},to=_(x()),ti=_(P()),ta=_(E()),ts=(w("div")(S(),t=>t.primary||"#ff4b4b",to,ti,t=>t.secondary||"#fff",ta),_(T())),tc=(w("div")(D(),t=>t.secondary||"#e0e0e0",t=>t.primary||"#616161",ts),_(M())),tu=_(F()),th=(w("div")(O(),t=>t.primary||"#61d345",tc,tu,t=>t.secondary||"#fff"),w("div")(k()),w("div")(A()),_(I()));w("div")(C(),th),w("div")(W()),w("div")(N()),r=i.createElement,p.p=void 0,g=r,b=void 0,y=void 0,m(B());var tp=Y},33764:(t,e,n)=>{n.d(e,{l7:()=>P});var r=n(49509);let o={cache:"no-store"},i=t=>a+(!1===t?"":" AssemblyAI/1.0 ("+Object.entries({...s,...t}).map(([t,e])=>e?`${t}=${e.name}/${e.version}`:"").join(" ")+")"),a="";"undefined"!=typeof navigator&&navigator.userAgent&&(a+=navigator.userAgent);let s={sdk:{name:"JavaScript",version:"4.9.0"}};void 0!==r&&(r.versions.node&&-1===a.indexOf("Node")&&(s.runtime_env={name:"Node",version:r.versions.node}),r.versions.bun&&-1===a.indexOf("Bun")&&(s.runtime_env={name:"Bun",version:r.versions.bun})),"undefined"!=typeof Deno&&r.versions.bun&&-1===a.indexOf("Deno")&&(s.runtime_env={name:"Deno",version:Deno.version.deno});class c{constructor(t){this.params=t,!1===t.userAgent?this.userAgent=void 0:this.userAgent=i(t.userAgent||{})}async fetch(t,e){e={...o,...e};let n={Authorization:this.params.apiKey,"Content-Type":"application/json"};o?.headers&&(n={...n,...o.headers}),e?.headers&&(n={...n,...e.headers}),this.userAgent&&(n["User-Agent"]=this.userAgent,"undefined"!=typeof window&&"chrome"in window&&(n["AssemblyAI-Agent"]=this.userAgent)),e.headers=n,t.startsWith("http")||(t=this.params.baseUrl+t);let r=await fetch(t,e);if(r.status>=400){let t;let e=await r.text();if(e){try{t=JSON.parse(e)}catch{}if(t?.error)throw Error(t.error);throw Error(e)}throw Error(`HTTP Error: ${r.status} ${r.statusText}`)}return r}async fetchJson(t,e){return(await this.fetch(t,e)).json()}}class u extends c{summary(t){return this.fetchJson("/lemur/v3/generate/summary",{method:"POST",body:JSON.stringify(t)})}questionAnswer(t){return this.fetchJson("/lemur/v3/generate/question-answer",{method:"POST",body:JSON.stringify(t)})}actionItems(t){return this.fetchJson("/lemur/v3/generate/action-items",{method:"POST",body:JSON.stringify(t)})}task(t){return this.fetchJson("/lemur/v3/generate/task",{method:"POST",body:JSON.stringify(t)})}getResponse(t){return this.fetchJson(`/lemur/v3/${t}`)}purgeRequestData(t){return this.fetchJson(`/lemur/v3/${t}`,{method:"DELETE"})}}let{WritableStream:h}="undefined"!=typeof window?window:"undefined"!=typeof global?global:globalThis,p=WebSocket??global?.WebSocket??window?.WebSocket??self?.WebSocket,f=(t,e)=>e?new p(t,e):new p(t),l={BadSampleRate:4e3,AuthFailed:4001,InsufficientFunds:4002,FreeTierUser:4003,NonexistentSessionId:4004,SessionExpired:4008,ClosedSession:4010,RateLimited:4029,UniqueSessionViolation:4030,SessionTimeout:4031,AudioTooShort:4032,AudioTooLong:4033,AudioTooSmallToTranscode:4034,BadJson:4100,BadSchema:4101,TooManyStreams:4102,Reconnected:4103,ReconnectAttemptsExhausted:1013,WordBoostParameterParsingFailed:4104},d={[l.BadSampleRate]:"Sample rate must be a positive integer",[l.AuthFailed]:"Not Authorized",[l.InsufficientFunds]:"Insufficient funds",[l.FreeTierUser]:"This feature is paid-only and requires you to add a credit card. Please visit https://app.assemblyai.com/ to add a credit card to your account.",[l.NonexistentSessionId]:"Session ID does not exist",[l.SessionExpired]:"Session has expired",[l.ClosedSession]:"Session is closed",[l.RateLimited]:"Rate limited",[l.UniqueSessionViolation]:"Unique session violation",[l.SessionTimeout]:"Session Timeout",[l.AudioTooShort]:"Audio too short",[l.AudioTooLong]:"Audio too long",[l.AudioTooSmallToTranscode]:"Audio too small to transcode",[l.BadJson]:"Bad JSON",[l.BadSchema]:"Bad schema",[l.TooManyStreams]:"Too many streams",[l.Reconnected]:"This session has been reconnected. This WebSocket is no longer valid.",[l.ReconnectAttemptsExhausted]:"Reconnect attempts exhausted",[l.WordBoostParameterParsingFailed]:"Could not parse word boost parameter"};class v extends Error{}let m='{"terminate_session":true}';class g{constructor(t){if(this.listeners={},this.realtimeUrl=t.realtimeUrl??"wss://api.assemblyai.com/v2/realtime/ws",this.sampleRate=t.sampleRate??16e3,this.wordBoost=t.wordBoost,this.encoding=t.encoding,this.endUtteranceSilenceThreshold=t.endUtteranceSilenceThreshold,this.disablePartialTranscripts=t.disablePartialTranscripts,"token"in t&&t.token&&(this.token=t.token),"apiKey"in t&&t.apiKey&&(this.apiKey=t.apiKey),!(this.token||this.apiKey))throw Error("API key or temporary token is required.")}connectionUrl(){let t=new URL(this.realtimeUrl);if("wss:"!==t.protocol)throw Error("Invalid protocol, must be wss");let e=new URLSearchParams;return this.token&&e.set("token",this.token),e.set("sample_rate",this.sampleRate.toString()),this.wordBoost&&this.wordBoost.length>0&&e.set("word_boost",JSON.stringify(this.wordBoost)),this.encoding&&e.set("encoding",this.encoding),e.set("enable_extra_session_information","true"),this.disablePartialTranscripts&&e.set("disable_partial_transcripts",this.disablePartialTranscripts.toString()),t.search=e.toString(),t}on(t,e){this.listeners[t]=e}connect(){return new Promise(t=>{if(this.socket)throw Error("Already connected");let e=this.connectionUrl();this.token?this.socket=f(e.toString()):(console.warn(`API key authentication is not supported for the RealtimeTranscriber in browser environment. Use temporary token authentication instead.
Learn more at https://github.com/AssemblyAI/assemblyai-node-sdk/blob/main/docs/compat.md#browser-compatibility.`),this.socket=f(e.toString(),{headers:{Authorization:this.apiKey}})),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{void 0!==this.endUtteranceSilenceThreshold&&null!==this.endUtteranceSilenceThreshold&&this.configureEndUtteranceSilenceThreshold(this.endUtteranceSilenceThreshold)},this.socket.onclose=({code:t,reason:e})=>{!e&&t in d&&(e=d[t]),this.listeners.close?.(t,e)},this.socket.onerror=t=>{t.error?this.listeners.error?.(t.error):this.listeners.error?.(Error(t.message))},this.socket.onmessage=({data:e})=>{let n=JSON.parse(e.toString());if("error"in n){this.listeners.error?.(new v(n.error));return}switch(n.message_type){case"SessionBegins":{let e={sessionId:n.session_id,expiresAt:new Date(n.expires_at)};t(e),this.listeners.open?.(e);break}case"PartialTranscript":n.created=new Date(n.created),this.listeners.transcript?.(n),this.listeners["transcript.partial"]?.(n);break;case"FinalTranscript":n.created=new Date(n.created),this.listeners.transcript?.(n),this.listeners["transcript.final"]?.(n);break;case"SessionInformation":this.listeners.session_information?.(n);break;case"SessionTerminated":this.sessionTerminatedResolve?.()}}})}sendAudio(t){this.send(t)}stream(){return new h({write:t=>{this.sendAudio(t)}})}forceEndUtterance(){this.send('{"force_end_utterance":true}')}configureEndUtteranceSilenceThreshold(t){this.send(`{"end_utterance_silence_threshold":${t}}`)}send(t){if(!this.socket||this.socket.readyState!==this.socket.OPEN)throw Error("Socket is not open for communication");this.socket.send(t)}async close(t=!0){if(this.socket){if(this.socket.readyState===this.socket.OPEN){if(t){let t=new Promise(t=>{this.sessionTerminatedResolve=t});this.socket.send(m),await t}else this.socket.send(m)}this.socket?.removeAllListeners&&this.socket.removeAllListeners(),this.socket.close()}this.listeners={},this.socket=void 0}}class b extends c{constructor(t){super(t),this.rtFactoryParams=t}createService(t){return this.transcriber(t)}transcriber(t){let e={...t};return e.token||e.apiKey||(e.apiKey=this.rtFactoryParams.apiKey),new g(e)}async createTemporaryToken(t){return(await this.fetchJson("/v2/realtime/token",{method:"POST",body:JSON.stringify(t)})).token}}function y(t){return t.startsWith("http")||t.startsWith("https")||t.startsWith("data:")?null:t.startsWith("file://")?t.substring(7):t.startsWith("file:")?t.substring(5):t}class _ extends c{constructor(t,e){super(t),this.files=e}async transcribe(t,e){let n=await this.submit(t);return await this.waitUntilReady(n.id,e)}async submit(t){let e,n;if("audio"in t){let{audio:r,...o}=t;if("string"==typeof r){let t=y(r);e=null!==t?await this.files.upload(t):r.startsWith("data:")?await this.files.upload(r):r}else e=await this.files.upload(r);n={...o,audio_url:e}}else n=t;return await this.fetchJson("/v2/transcript",{method:"POST",body:JSON.stringify(n)})}async create(t,e){let n=y(t.audio_url);null!==n&&(t.audio_url=await this.files.upload(n));let r=await this.fetchJson("/v2/transcript",{method:"POST",body:JSON.stringify(t)});return e?.poll??!0?await this.waitUntilReady(r.id,e):r}async waitUntilReady(t,e){let n=e?.pollingInterval??3e3,r=e?.pollingTimeout??-1,o=Date.now();for(;;){let e=await this.get(t);if("completed"===e.status||"error"===e.status)return e;if(r>0&&Date.now()-o>r)throw Error("Polling timeout");await new Promise(t=>setTimeout(t,n))}}get(t){return this.fetchJson(`/v2/transcript/${t}`)}async list(t){let e="/v2/transcript";"string"==typeof t?e=t:t&&(e=`${e}?${new URLSearchParams(Object.keys(t).map(e=>[e,t[e]?.toString()||""]))}`);let n=await this.fetchJson(e);for(let t of n.transcripts)t.created=new Date(t.created),t.completed&&(t.completed=new Date(t.completed));return n}delete(t){return this.fetchJson(`/v2/transcript/${t}`,{method:"DELETE"})}wordSearch(t,e){let n=new URLSearchParams({words:e.join(",")});return this.fetchJson(`/v2/transcript/${t}/word-search?${n.toString()}`)}sentences(t){return this.fetchJson(`/v2/transcript/${t}/sentences`)}paragraphs(t){return this.fetchJson(`/v2/transcript/${t}/paragraphs`)}async subtitles(t,e="srt",n){let r=`/v2/transcript/${t}/${e}`;if(n){let t=new URLSearchParams;t.set("chars_per_caption",n.toString()),r+=`?${t.toString()}`}let o=await this.fetch(r);return await o.text()}redactions(t){return this.redactedAudio(t)}redactedAudio(t){return this.fetchJson(`/v2/transcript/${t}/redacted-audio`)}async redactedAudioFile(t){let{redacted_audio_url:e,status:n}=await this.redactedAudio(t);if("redacted_audio_ready"!==n)throw Error(`Redacted audio status is ${n}`);let r=await fetch(e);if(!r.ok)throw Error(`Failed to fetch redacted audio: ${r.statusText}`);return{arrayBuffer:r.arrayBuffer.bind(r),blob:r.blob.bind(r),body:r.body,bodyUsed:r.bodyUsed}}}let w=async function(t){throw Error("Interacting with the file system is not supported in this environment.")};class x extends c{async upload(t){let e;return e="string"==typeof t?t.startsWith("data:")?function(t){let e=t.split(","),n=e[0].match(/:(.*?);/)[1],r=atob(e[1]),o=r.length,i=new Uint8Array(o);for(;o--;)i[o]=r.charCodeAt(o);return new Blob([i],{type:n})}(t):await w():t,(await this.fetchJson("/v2/upload",{method:"POST",body:e,headers:{"Content-Type":"application/octet-stream"},duplex:"half"})).upload_url}}class P{constructor(t){t.baseUrl=t.baseUrl||"https://api.assemblyai.com",t.baseUrl&&t.baseUrl.endsWith("/")&&(t.baseUrl=t.baseUrl.slice(0,-1)),this.files=new x(t),this.transcripts=new _(t,this.files),this.lemur=new u(t),this.realtime=new b(t)}}},35695:(t,e,n)=>{var r=n(18999);n.o(r,"notFound")&&n.d(e,{notFound:function(){return r.notFound}}),n.o(r,"useParams")&&n.d(e,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(e,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(e,{useRouter:function(){return r.useRouter}})},50438:(t,e,n)=>{n.d(e,{ex:()=>t7,R:()=>eA,B0:()=>el});var r,o,i,a,s=n(449),c=function(t,e){return(c=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function u(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var h=function(){return(h=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function p(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})}function f(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),o=0,e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var d=function(){function t(t,e){if(!_(t)||!_(e))throw Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function v(t,e){return t instanceof s.qYS&&t.shape.length===e}function m(t){return v(t,4)}function g(t){return t&&t.width&&t.height}function b(t){return t.reduce(function(t,e){return t.add(e)},new x(0,0)).div(new x(t.length,t.length))}function y(t,e,n){return Array(t).fill(0).map(function(t,r){return e+r*n})}function _(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function w(t){return _(t)&&0<=t&&t<=1}var x=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),P=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(_),i=[r.x,r.y,r.width,r.height].every(_);if(!i&&!o)throw Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],c=a[1],u=a[2],h=a[3];t.assertIsValidBox({x:s,y:c,width:u,height:h},"Box.constructor",n),this._x=s,this._y=c,this._width=u,this._height=h}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(_)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new x(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new x(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new x(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new x(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this.x,n=this.y,r=this.width,o=this.height,i=Math.abs(r-o);return r<o&&(e-=i/2,r+=i),o<r&&(n-=i/2,o+=i),new t({x:e,y:n,width:r,height:o})},t.prototype.rescale=function(e){var n=g(e)?e.width:e,r=g(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this.x,o=this.y,i=this.right,a=this.bottom,s=Math.max(r,0),c=Math.max(o,0),u=Math.min(i-s,e-s),h=Math.min(a-c,n-c);return new t({x:s,y:c,width:u,height:h}).floor()},t.prototype.shift=function(e,n){var r=this.width,o=this.height;return new t({x:this.x+e,y:this.y+n,width:r,height:o})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,o=n,i=r,a=this.left,s=this.top,c=this.right,u=this.bottom;return c>e&&(o=-c+e+n,c=e),u>t&&(i=-u+t+r,u=t),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:u,x:a,ex:c,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),E=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{left:e,top:n,right:r,bottom:o},i)||this}return u(e,t),e}(P),S=function(){function t(t,e,n,r,o){this._imageDims=new d(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new P(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new P(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),T=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return u(e,t),e.prototype.forSize=function(n,r){var o=t.prototype.forSize.call(this,n,r);return new e(o.score,o.relativeBox,o.imageDims)},e}(S);function D(t,e,n,r){void 0===r&&(r=!0);for(var o=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),i=[];o.length>0;)!function(){var e=o.pop();i.push(e);for(var a=o,s=[],c=0;c<a.length;c++){var u=a[c],h=t[e],p=t[u];s.push(function(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}(h,p,r))}o=o.filter(function(t,e){return s[e]<=n})}();return i}function M(t,e){return s.DZQ(function(){var n=e[0],r=e[1],o=e[2],i=s.GSj(l(t.shape.slice(0,3),[1]),n),a=s.GSj(l(t.shape.slice(0,3),[1]),r),c=s.GSj(l(t.shape.slice(0,3),[1]),o),u=s.xWs([i,a,c],3);return s.jbE(t,u)})}function F(t){return 1/(1+Math.exp(-t))}var O=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{x:e,y:n,width:r,height:o},i)||this}return u(e,t),e}(P),k=function(){function t(t,e,n){void 0===n&&(n=new x(0,0));var r=e.width,o=e.height;this._imgDims=new d(r,o),this._shift=n,this._positions=t.map(function(t){return t.mul(new x(r,o)).add(n)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new x(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new x(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new x(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof T?t.box.floor():new P(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=r.useDlibAlignment,i=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],r=t[2],o=function(t){return r.sub(t).magnitude()},i=Math.floor((o(e)+o(n))/2/.45),a=b(t),s=Math.floor(Math.max(0,a.x-.5*i)),c=Math.floor(Math.max(0,a.y-.43*i));return new O(s,c,Math.min(i,this.imageWidth+s),Math.min(i,this.imageHeight+c))},t.prototype.alignMinBbox=function(t){var e,n,r,o=(n=(e=this.positions).map(function(t){return t.x}),r=e.map(function(t){return t.y}),new E(n.reduce(function(t,e){return e<t?e:t},1/0),r.reduce(function(t,e){return e<t?e:t},1/0),n.reduce(function(t,e){return t<e?e:t},0),r.reduce(function(t,e){return t<e?e:t},0)));return o.pad(o.width*t,o.height*t)},t.prototype.getRefPointsForAlignment=function(){throw Error("getRefPointsForAlignment not implemented by base class")},t}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],b([t[3],t[4]])]},e}(k),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(b)},e}(k),C=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){var e,n,r;return void 0===t&&(t=!0),""+this.label+(t?" ("+(e=this.distance,void 0===n&&(n=2),Math.floor(e*(r=Math.pow(10,n)))/r)+")":"")},t}(),W=function(t){function e(e,n){var r=t.call(this,e)||this;return r._label=n,r}return u(e,t),e.assertIsValidLabeledBox=function(t,e){if(P.assertIsValidBox(t,e),!_(t.label))throw Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(P),N=function(){function t(t,e){if("string"!=typeof t)throw Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(t){return new Float32Array(t)});return new t(e.label,n)},t}();function B(t,e){return Object.assign({},t,{detection:e})}!function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i._score=r,i._classScore=o,i}u(e,t),e.assertIsValidPredictedBox=function(t,e){if(W.assertIsValidLabeledBox(t,e),!w(t.score)||!w(t.classScore))throw Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(W);var L=n(49509);function R(){return"object"==typeof n.g&&void 0!==L&&!!L.version}var z={getEnv:function(){if(!r)throw Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return r},isNodejs:R};function V(t){return z.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function U(t){var e=z.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var r=V(t);if(!(r instanceof n))throw Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw Error("resolveContext2d - canvas 2d context is null");return o}(function(){if("object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D&&(r={Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:window.fetch||function(){throw Error("fetch - missing fetch implementation for browser environment")},readFile:function(){throw Error("readFile - filesystem not available for browser environment")}}),R()){var t,e,o,i;t=n.g.Canvas||n.g.HTMLCanvasElement,e=n.g.Image||n.g.HTMLImageElement,o=n.g.fetch||function(){throw Error("fetch - missing fetch implementation for nodejs environment")},i=function(t){var e="";if(!t)try{t=n(Object(function(){var t=Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}()))}catch(t){e=t.toString()}return{readFile:t?function(e){return new Promise(function(n,r){t.readFile(e,function(t,e){return t?r(t):n(e)})})}:function(){throw Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}(),r=h({Canvas:t||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i)}})(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(o||(o={}));var q=function(t){void 0===t&&(t={});var e=t.anchorPosition,n=t.backgroundColor,r=t.fontColor,i=t.fontSize,a=t.fontStyle,s=t.padding;this.anchorPosition=e||o.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4},G=function(){function t(e,n,r){void 0===r&&(r={}),this.text="string"==typeof e?[e]:e instanceof t?e.text:e,this.anchor=n,this.options=new q(r)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(e){return t.measureText(e).width}).reduce(function(t,e){return t<e?e:t},0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},t.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,r=n===o.BOTTOM_RIGHT||n===o.TOP_RIGHT,i=n===o.BOTTOM_LEFT||n===o.BOTTOM_RIGHT,a=this.measureWidth(t),s=this.measureHeight(),c=r?this.anchor.x-a:this.anchor.x,u=i?this.anchor.y-s:this.anchor.y;return e?{x:Math.max(Math.min(c,e.width-a),0),y:Math.max(Math.min(u,e.height-s),0)}:{x:c,y:u}},t.prototype.draw=function(t){var e=V(t),n=U(e),r=this.options,o=r.backgroundColor,i=r.fontColor,a=r.fontSize,s=r.fontStyle,c=r.padding;n.font=a+"px "+s;var u=this.measureWidth(n),h=this.measureHeight();n.fillStyle=o;var p=this.getUpperLeft(n,e);n.fillRect(p.x,p.y,u,h),n.fillStyle=i,this.text.forEach(function(t,e){var r=c+p.x,o=c+p.y+(e+1)*a;n.fillText(t,r,o)})},t}(),Z=function(t){void 0===t&&(t={});var e=t.boxColor,n=t.lineWidth,r=t.label,i=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:o.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new q(Object.assign({},a,i))};function $(t){var e=z.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function K(t){var e=z.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new d(t.naturalWidth,t.naturalHeight):t instanceof r?new d(t.videoWidth,t.videoHeight):new d(t.width,t.height)}function J(t){var e=t.width,n=t.height,r=(0,z.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function X(t,e){var n=z.getEnv().ImageData;if(!(t instanceof n)&&!$(t))throw Error("createCanvasFromMedia - media has not finished loading yet");var r=e||K(t),o=r.width,i=r.height,a=J({width:o,height:i});return t instanceof n?U(a).putImageData(t,0,0):U(a).drawImage(t,0,0,o,i),a}function Y(t){var e=z.getEnv(),n=e.Image,r=e.Canvas,o=e.Video;return t instanceof n||t instanceof r||t instanceof o}(function(t,e){void 0===e&&(e={}),this.box=new P(t),this.options=new Z(e)}).prototype.draw=function(t){var e=U(t),n=this.options,r=n.boxColor,o=n.lineWidth,i=this.box,a=i.x,s=i.y,c=i.width,u=i.height;e.strokeStyle=r,e.lineWidth=o,e.strokeRect(a,s,c,u);var h=this.options.label;h&&new G([h],{x:a-o/2,y:s},this.options.drawLabelOptions).draw(t)};var tt=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(v(t,3)){n._imageTensors[e]=t,n._inputDimensions[e]=t.shape;return}if(m(t)){var r=t.shape[0];if(1!==r)throw Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");n._imageTensors[e]=t,n._inputDimensions[e]=t.shape.slice(1);return}var o=t instanceof z.getEnv().Canvas?t:X(t);n._canvases[e]=o,n._inputDimensions[e]=[o.height,o.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return y(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){var e,n,r,o,i;if("number"!=typeof this.inputSize)throw Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return e={width:this.getInputWidth(t),height:this.getInputHeight(t)},n=this.inputSize,r=e.width,i=n/Math.max(o=e.height,r),new d(Math.round(r*i),Math.round(o*i))},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,s.DZQ(function(){var r=y(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof s.qYS){var i,a,c=m(o)?o:o.expandDims();return i=c,void 0===(a=e)&&(a=!1),((c=s.DZQ(function(){var t=i.shape.slice(1),e=t[0],n=t[1];if(e===n)return i;var r=Math.abs(e-n),o=e>n?2:1,c=function(t){var e=i.shape.slice();return e[o]=t,s.GSj(e,0)},u=c(Math.round(r*(a?.5:1))),h=r-u.shape[o],p=[a&&h?c(h):null,i,u].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return s.xWs(p,o)})).shape[1]!==t||c.shape[2]!==t)&&(c=s.Slp.resizeBilinear(c,[t,t])),c.as3D(t,t,3)}if(o instanceof z.getEnv().Canvas)return s.TaL.fromPixels(function(t,e,n){void 0===n&&(n=!1);var r=z.getEnv(),o=r.Image,i=r.Canvas;if(!(t instanceof o||t instanceof i))throw Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=K(t),s=e/Math.max(a.height,a.width),c=s*a.width,u=s*a.height,h=J({width:e,height:e}),p=t instanceof i?t:X(t),f=Math.abs(c-u)/2,l=n&&c<u?f:0,d=n&&u<c?f:0;return U(h).drawImage(p,l,d,c,u),h}(o,t,e));throw Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)});return s.t$z(r.map(function(t){return t.toFloat()})).as4D(n.batchSize,t,t,3)})},t}();function te(t){return p(this,void 0,void 0,function(){var e,n,r;return f(this,function(o){switch(o.label){case 0:if(t instanceof tt)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(V)).forEach(function(t,r){if(!Y(t)&&!v(t,3)&&!m(t)){if("string"==typeof e[r])throw Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(m(t)){var o=t.shape[0];if(1!==o)throw Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(t){return Y(t)&&new Promise(function(e,n){if(t instanceof z.getEnv().Canvas||$(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),n(t))}t.addEventListener("load",r),t.addEventListener("error",o)})}))];case 1:return o.sent(),[2,new tt(r,Array.isArray(t))]}})})}function tn(t,e){return p(this,void 0,void 0,function(){var n,r,o,i,a,c;return f(this,function(u){switch(u.label){case 0:if(n=z.getEnv().Canvas,r=t,t instanceof n)return[3,5];return[4,te(t)];case 1:if((o=u.sent()).batchSize>1)throw Error("extractFaces - batchSize > 1 not supported");if(!((i=o.getInput(0))instanceof n))return[3,2];return a=i,[3,4];case 2:return[4,function(t,e){return p(this,void 0,void 0,function(){var e,n,r,o,i,a;return f(this,function(c){switch(c.label){case 0:return e=z.getEnv().createCanvasElement(),r=(n=t.shape.slice(+!!m(t)))[0],o=n[1],i=n[2],a=s.DZQ(function(){return t.as3D(r,o,i).toInt()}),[4,s.TaL.toPixels(a,e)];case 1:return c.sent(),a.dispose(),[2,e]}})})}(i)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return c=U(r),[2,e.map(function(t){return t instanceof T?t.forSize(r.width,r.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(r.width,r.height)}).map(function(t){var e=t.x,n=t.y,r=t.width,o=t.height,i=J({width:r,height:o});return U(i).putImageData(c.getImageData(e,n,r,o),0,0),i})]}})})}function tr(t,e){return p(this,void 0,void 0,function(){return f(this,function(n){if(!v(t,3)&&!m(t))throw Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(m(t)&&t.shape[0]>1)throw Error("extractFaceTensors - batchSize > 1 not supported");return[2,s.DZQ(function(){var n=t.shape.slice(+!!m(t)),r=n[0],o=n[1],i=n[2];return e.map(function(t){return t instanceof T?t.forSize(o,r).box:t}).map(function(t){return t.clipAtImageBorders(o,r)}).map(function(e){var n=e.x,a=e.y,c=e.width,u=e.height;return s.wck(t.as3D(r,o,i),[a,n,0],[u,c,i])})})]})})}function to(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter(function(t){return t}),i=t.endsWith(".json")?o[o.length-1]:n,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}var ti=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof s.rTt})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof s.rTt)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,r=e.tensor;t.reassignParamFromPath(n,r.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,r=e.tensor,o=s.OEK(r.dataSync());r.dispose(),t.reassignParamFromPath(n,o)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){return Array.from(t.tensor.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return p(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:if(t instanceof Float32Array)return this.extractWeights(t),[2];return[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:if(t&&"string"!=typeof t)throw Error(this._name+".loadFromUri - expected model uri");return[4,function(t,e){return p(this,void 0,void 0,function(){var n,r,o,i;return f(this,function(a){switch(a.label){case 0:return r=(n=to(t,e)).manifestUri,o=n.modelBaseUri,[4,function(t){return p(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,function(t,e){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return[4,(0,z.getEnv().fetch)(t,void 0)];case 1:if(!((e=n.sent()).status<400))throw Error("failed to fetch: ("+e.status+") "+e.statusText+", from url: "+e.url);return[2,e]}})})}(t)];case 1:return[2,e.sent().json()]}})})}(r)];case 1:return i=a.sent(),[2,s.io.loadWeights(i,o)]}})})}(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return p(this,void 0,void 0,function(){var e,n,r,o,i,a,c,u,h,p;return f(this,function(f){switch(f.label){case 0:if(t&&"string"!=typeof t)throw Error(this._name+".loadFromDisk - expected model file path");return e=z.getEnv().readFile,r=(n=to(t,this.getDefaultModelName())).manifestUri,o=n.modelBaseUri,i=function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))},a=s.io.weightsLoaderFactory(i),h=(u=JSON).parse,[4,e(r)];case 1:return c=h.apply(u,[f.sent().toString()]),[4,a(c,o)];case 2:return p=f.sent(),this.loadFromWeightMap(p),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.traversePropertyPath=function(t){if(!this.params)throw Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,n){if(!e.nextObj.hasOwnProperty(n))throw Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}},{nextObj:this.params}),n=e.obj,r=e.objProp;if(!n||!r||!(n[r]instanceof s.qYS))throw Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function ta(t,e,n){return s.DZQ(function(){var r=s.wdz(t,e.depthwise_filter,e.pointwise_filter,n,"same");return s.WQq(r,e.bias)})}function ts(t,e,n){return void 0===n&&(n=!1),s.DZQ(function(){var r=s.VVh(n?s.WQq(s.Xtf(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):ta(t,e.conv0,[2,2])),o=ta(r,e.conv1,[1,1]),i=ta(s.VVh(s.WQq(r,o)),e.conv2,[1,1]);return s.VVh(s.WQq(r,s.WQq(o,i)))})}function tc(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),s.DZQ(function(){var o=s.VVh(n?s.WQq(s.Xtf(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):ta(t,e.conv0,r?[2,2]:[1,1])),i=ta(o,e.conv1,[1,1]),a=ta(s.VVh(s.WQq(o,i)),e.conv2,[1,1]),c=ta(s.VVh(s.WQq(o,s.WQq(i,a))),e.conv3,[1,1]);return s.VVh(s.WQq(o,s.WQq(i,s.WQq(a,c))))})}function tu(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),s.DZQ(function(){var o=s.WQq(s.Xtf(t,e.filters,[1,1],n),e.bias);return r?s.VVh(o):o})}function th(t,e){Object.keys(t).forEach(function(n){e.some(function(t){return t.originalPath===n})||t[n].dispose()})}function tp(t,e){return function(n,r,o,i){var a=s.g9W(t(n*r*o*o),[o,o,n,r]),c=s.tGX(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:c}}}function tf(t,e){return function(n,r,o){var i=s.KtR(t(n*r),[n,r]),a=s.tGX(t(r));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var tl=function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n};function td(t,e){return function(n,r,o){var i=s.g9W(t(9*n),[3,3,n,1]),a=s.g9W(t(n*r),[1,1,n,r]),c=s.tGX(t(r));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new tl(i,a,c)}}function tv(t){return function(e){return new tl(t(e+"/depthwise_filter",4),t(e+"/pointwise_filter",4),t(e+"/bias",1))}}function tm(t,e){return function(n,r,o){var i=t[n];if(!v(i,r))throw Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:n,paramPath:o||n}),i}}function tg(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function tb(t,e){var n=tp(t,e),r=td(t,e);function o(t,e,o,i){return void 0===i&&(i=!1),{conv0:i?n(t,e,3,o+"/conv0"):r(t,e,o+"/conv0"),conv1:r(e,e,o+"/conv1"),conv2:r(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,n,i){void 0===i&&(i=!1);var a=o(t,e,n,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(e,e,n+"/conv3")}}}}function ty(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function t_(t,e){var n=tm(t,e),r=ty(n),o=tv(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var tw=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return u(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("FaceFeatureExtractor - load model before inference");return s.DZQ(function(){var n=tc(M(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(s.d_2(255)),e.dense0,!0);return n=tc(n,e.dense1),n=tc(n,e.dense2),n=tc(n,e.dense3),n=s.$jT(n,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,n,r;return r={dense0:(n=t_(t,e=[]).extractDenseBlock4Params)("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")},th(t,e),{params:r,paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=[],n=tg(t),r=n.extractWeights,o=n.getRemainingWeights,i=tb(r,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:c,dense3:u}}}(t)},e}(ti);function tx(t,e){return s.DZQ(function(){return s.WQq(s.NoW(t,e.weights),e.bias)})}function tP(t){var e={},n={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?n:e)[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var tE=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return u(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw Error(this._name+" - load model before inference");return s.DZQ(function(){var r=t instanceof tt?e.faceFeatureExtractor.forwardInput(t):t;return tx(r.as2D(r.shape[0],-1),n.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],o=tg(t),i=o.extractWeights,a=o.getRemainingWeights,s=tf(i,r)(e,n,"fc");if(0!==a().length)throw Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:s}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e,n,r,o=tP(t),i=o.featureExtractorMap,a=o.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),r={fc:{weights:(n=tm(a,e=[]))("fc/weights",2),bias:n("fc/bias",1)}},th(a,e),{params:r,paramMappings:e}},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(ti),tS=["neutral","happy","sad","angry","fearful","disgusted","surprised"],tT=function(){function t(t){var e=this;if(7!==t.length)throw Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);tS.forEach(function(n,r){e[n]=t[r]})}return t.prototype.asSortedArray=function(){var t=this;return tS.map(function(e){return{expression:e,probability:t[e]}}).sort(function(t,e){return e.probability-t.probability})},t}(),tD=function(t){function e(e){return void 0===e&&(e=new tw),t.call(this,"FaceExpressionNet",e)||this}return u(e,t),e.prototype.forwardInput=function(t){var e=this;return s.DZQ(function(){return s.Vs9(e.runNet(t))})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictExpressions=function(t){return p(this,void 0,void 0,function(){var e,n,r,o,i=this;return f(this,function(a){switch(a.label){case 0:return[4,te(t)];case 1:return e=a.sent(),[4,this.forwardInput(e)];case 2:return n=a.sent(),[4,Promise.all(s.K$i(n).map(function(t){return p(i,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}})})}))];case 3:return r=a.sent(),n.dispose(),o=r.map(function(t){return new tT(t)}),[2,e.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(tE);function tM(t,e){return Object.assign({},t,{expressions:e})}function tF(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),o=r.align(),i=t.detection.imageDims,a=new T(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:e,alignedRect:a})}function tO(t,e,n){if(void 0===n&&(n=!1),t.beginPath(),e.slice(1).forEach(function(n,r){var o=n.x,i=n.y,a=e[r];t.moveTo(a.x,a.y),t.lineTo(o,i)}),n){var r=e[e.length-1],o=e[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}var tk=function(t){void 0===t&&(t={});var e=t.drawLines,n=t.drawPoints,r=t.lineWidth,o=t.lineColor,i=t.pointSize,a=t.pointColor;this.drawLines=void 0===e||e,this.drawPoints=void 0===n||n,this.lineWidth=r||1,this.pointSize=i||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=a||"rgba(255, 0, 255, 1)"};function tj(t,e,n){return s.WQq(s.Xtf(t,e.filters,n,"same"),e.bias)}function tA(t,e,n){void 0===n&&(n=!0);var r=n?s.VVh(t):t;return r=ta(r,e.separable_conv0,[1,1]),r=ta(s.VVh(r),e.separable_conv1,[1,1]),r=s.jgi(r,[3,3],[2,2],"same"),r=s.WQq(r,tj(t,e.expansion_conv,[2,2]))}(function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new tk(e)}t.prototype.draw=function(t){var e=U(t),n=this.options,r=n.drawLines,o=n.drawPoints,i=n.lineWidth,a=n.lineColor,s=n.pointSize,c=n.pointColor;r&&this.faceLandmarks instanceof I&&(e.strokeStyle=a,e.lineWidth=i,tO(e,this.faceLandmarks.getJawOutline()),tO(e,this.faceLandmarks.getLeftEyeBrow()),tO(e,this.faceLandmarks.getRightEyeBrow()),tO(e,this.faceLandmarks.getNose()),tO(e,this.faceLandmarks.getLeftEye(),!0),tO(e,this.faceLandmarks.getRightEye(),!0),tO(e,this.faceLandmarks.getMouth(),!0)),o&&(e.strokeStyle=c,e.fillStyle=c,this.faceLandmarks.positions.forEach(function(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fill()}))}})();var tI=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return u(e,t),e.prototype.forwardInput=function(t){var e=this,n=this.params;if(!n)throw Error("TinyXception - load model before inference");return s.DZQ(function(){var r=M(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(s.d_2(256)),o=s.VVh(tj(r,n.entry_flow.conv_in,[2,2]));return o=tA(o,n.entry_flow.reduction_block_0,!1),o=tA(o,n.entry_flow.reduction_block_1),y(e._numMainBlocks,0,1).forEach(function(t){var e,r,i;e=o,r=n.middle_flow["main_block_"+t],i=ta(s.VVh(e),r.separable_conv0,[1,1]),i=ta(s.VVh(i),r.separable_conv1,[1,1]),i=ta(s.VVh(i),r.separable_conv2,[1,1]),o=i=s.WQq(i,e)}),o=tA(o,n.exit_flow.reduction_block),o=s.VVh(ta(o,n.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r,o,i=[],a={extractConvParams:r=ty(n=tm(t,i)),extractSeparableConvParams:o=tv(n),extractReductionBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),separable_conv2:o(t+"/separable_conv2")}}},s=a.extractConvParams,c=a.extractSeparableConvParams,u=a.extractReductionBlockParams,h=a.extractMainBlockParams,p=s("entry_flow/conv_in"),f=u("entry_flow/reduction_block_0"),l=u("entry_flow/reduction_block_1"),d={};y(e,0,1).forEach(function(t){d["main_block_"+t]=h("middle_flow/main_block_"+t)});var v=u("exit_flow/reduction_block"),m=c("exit_flow/separable_conv");return th(t,i),{params:{entry_flow:{conv_in:p,reduction_block_0:f,reduction_block_1:l},middle_flow:d,exit_flow:{reduction_block:v,separable_conv:m}},paramMappings:i}}(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return function(t,e){var n,r,o=[],i=tg(t),a=i.extractWeights,s=i.getRemainingWeights,c={extractConvParams:n=tp(a,o),extractSeparableConvParams:r=td(a,o),extractReductionBlockParams:function(t,e,o){return{separable_conv0:r(t,e,o+"/separable_conv0"),separable_conv1:r(e,e,o+"/separable_conv1"),expansion_conv:n(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}},u=c.extractConvParams,h=c.extractSeparableConvParams,p=c.extractReductionBlockParams,f=c.extractMainBlockParams,l=u(3,32,3,"entry_flow/conv_in"),d=p(32,64,"entry_flow/reduction_block_0"),v=p(64,128,"entry_flow/reduction_block_1"),m={};y(e,0,1).forEach(function(t){m["main_block_"+t]=f(128,"middle_flow/main_block_"+t)});var g=p(128,256,"exit_flow/reduction_block"),b=h(256,512,"exit_flow/separable_conv");if(0!==s().length)throw Error("weights remaing after extract: "+s().length);return{paramMappings:o,params:{entry_flow:{conv_in:l,reduction_block_0:d,reduction_block_1:v},middle_flow:m,exit_flow:{reduction_block:g,separable_conv:b}}}}(t,this._numMainBlocks)},e}(ti);!function(t){t.FEMALE="female",t.MALE="male"}(i||(i={}));var tC=function(t){function e(e){void 0===e&&(e=new tI(2));var n=t.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return u(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw Error(this._name+" - load model before inference");return s.DZQ(function(){var r=t instanceof tt?e.faceFeatureExtractor.forwardInput(t):t,o=s.$jT(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:tx(o,n.fc.age).as1D(),gender:tx(o,n.fc.gender)}})},e.prototype.forwardInput=function(t){var e=this;return s.DZQ(function(){var n=e.runNet(t),r=n.age,o=n.gender;return{age:r,gender:s.Vs9(o)}})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return p(this,void 0,void 0,function(){var e,n,r,o,a,c=this;return f(this,function(u){switch(u.label){case 0:return[4,te(t)];case 1:return e=u.sent(),[4,this.forwardInput(e)];case 2:return n=u.sent(),r=s.K$i(n.age),o=s.K$i(n.gender),[4,Promise.all(r.map(function(t,e){return{ageTensor:t,genderTensor:o[e]}}).map(function(t){var e=t.ageTensor,n=t.genderTensor;return p(c,void 0,void 0,function(){var t,r,o,a,s;return f(this,function(c){switch(c.label){case 0:return[4,e.data()];case 1:return t=c.sent()[0],[4,n.data()];case 2:return a=(o=(r=c.sent()[0])>.5)?i.MALE:i.FEMALE,s=o?r:1-r,e.dispose(),n.dispose(),[2,{age:t,gender:a,genderProbability:s}]}})})}))];case 3:return a=u.sent(),n.age.dispose(),n.gender.dispose(),[2,e.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=tg(t),r=n.extractWeights,o=n.getRemainingWeights,i=tf(r,e),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=tP(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e=[],n=tm(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return th(t,e),{params:o,paramMappings:e}}(r)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},e}(ti),tW=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.postProcess=function(t,e,n){var r=n.map(function(t){var n=t.width,r=t.height,o=e/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return s.DZQ(function(){var n=function(t,e){return s.t$z([s.GSj([68],t),s.GSj([68],e)],1).as2D(1,136).as1D()},i=function(t,e){var n=r[t],o=n.width,i=n.height;return e(o,i)?Math.abs(o-i)/2:0};return t.mul(s.GSj([o,136],e)).sub(s.t$z(Array.from(Array(o),function(t,e){return n(i(e,function(t,e){return t<e}),i(e,function(t,e){return e<t}))}))).div(s.t$z(Array.from(Array(o),function(t,e){return n(r[e].width,r[e].height)})))})},e.prototype.forwardInput=function(t){var e=this;return s.DZQ(function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.detectLandmarks=function(t){return p(this,void 0,void 0,function(){var e,n,r,o=this;return f(this,function(i){switch(i.label){case 0:return[4,te(t)];case 1:return e=i.sent(),[4,Promise.all((n=s.DZQ(function(){return s.K$i(o.forwardInput(e))})).map(function(t,n){return p(o,void 0,void 0,function(){var r,o,i,a,s;return f(this,function(c){switch(c.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return a=(r=i.apply(o,[c.sent()])).filter(function(t,e){return e%2==0}),s=r.filter(function(t,e){return e%2!=0}),[2,new I(Array(68).fill(0).map(function(t,e){return new x(a[e],s[e])}),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}})})}))];case 2:return r=i.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(tE),tN=function(t){function e(e){return void 0===e&&(e=new tw),t.call(this,"FaceLandmark68Net",e)||this}return u(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(tW),tB=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return u(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("TinyFaceFeatureExtractor - load model before inference");return s.DZQ(function(){var n=ts(M(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(s.d_2(255)),e.dense0,!0);return n=ts(n,e.dense1),n=ts(n,e.dense2),n=s.$jT(n,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,n,r;return r={dense0:(n=t_(t,e=[]).extractDenseBlock3Params)("dense0",!0),dense1:n("dense1"),dense2:n("dense2")},th(t,e),{params:r,paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=[],n=tg(t),r=n.extractWeights,o=n.getRemainingWeights,i=tb(r,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:c}}}(t)},e}(ti),tL=function(t){function e(e){return void 0===e&&(e=new tB),t.call(this,"FaceLandmark68TinyNet",e)||this}return u(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(tW);function tR(t,e,n,r,o){void 0===o&&(o="same");var i,a,c=e.conv,u=c.filters,h=c.bias,p=s.Xtf(t,u,n,o);return i=p=s.WQq(p,h),a=e.scale,p=s.WQq(s.lKK(i,a.weights),a.biases),r?s.VVh(p):p}function tQ(t,e){return tR(t,e,[1,1],!1)}function tz(t,e){return tR(t,e,[2,2],!0,"valid")}function tV(t,e){var n=tR(t,e.conv1,[1,1],!0);return n=tQ(n,e.conv2),n=s.WQq(n,t),n=s.VVh(n)}function tU(t,e){var n=tz(t,e.conv1);n=tQ(n,e.conv2);var r=s.$jT(t,2,2,"valid"),o=s.Ul9(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=l(n.shape);a[1]=1;var c=s.Ul9(a),u=l((n=s.xWs([n,c],1)).shape);u[2]=1;var h=s.Ul9(u);n=s.xWs([n,h],2)}return r=i?s.xWs([r,o],3):r,n=s.WQq(r,n),n=s.VVh(n)}!function(t){u(function(){return null!==t&&t.apply(this,arguments)||this},t)}(tN);var tq=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return u(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("FaceRecognitionNet - load model before inference");return s.DZQ(function(){var n=tz(M(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(s.d_2(256)),e.conv32_down);n=tV(n=s.jgi(n,3,2,"valid"),e.conv32_1),n=tV(n,e.conv32_2),n=tU(n=tV(n,e.conv32_3),e.conv64_down),n=tV(n,e.conv64_1),n=tV(n,e.conv64_2),n=tU(n=tV(n,e.conv64_3),e.conv128_down),n=tV(n,e.conv128_1),n=tU(n=tV(n,e.conv128_2),e.conv256_down),n=tV(n,e.conv256_1);var r=(n=tU(n=tV(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return s.NoW(r,e.fc)})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return p(this,void 0,void 0,function(){var e,n,r,o=this;return f(this,function(i){switch(i.label){case 0:return[4,te(t)];case 1:return e=i.sent(),[4,Promise.all((n=s.DZQ(function(){return s.K$i(o.forwardInput(e))})).map(function(t){return t.data()}))];case 2:return r=i.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=tm(t,e);function r(t){return{conv:{filters:n(t+"/conv/filters",4),bias:n(t+"/conv/bias",1)},scale:{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}(t,e),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),c=o("conv32_3"),u=o("conv64_down"),h=o("conv64_1"),p=o("conv64_2"),f=o("conv64_3"),l=o("conv128_down"),d=o("conv128_1"),m=o("conv128_2"),g=o("conv256_down"),b=o("conv256_1"),y=o("conv256_2"),_=o("conv256_down_out"),w=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!v(w,2))throw Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);return th(t,e),{params:{conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:h,conv64_2:p,conv64_3:f,conv128_down:l,conv128_1:d,conv128_2:m,conv256_down:g,conv256_1:b,conv256_2:y,conv256_down_out:_,fc:w},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=tg(t),n=e.extractWeights,r=e.getRemainingWeights,o=[],i=function(t,e){function n(n,r,o,i){var a,c,u,h,p,f;return{conv:(a=i+"/conv",c=function(e,n,r){var o=t(e),i=o.length/(n*r*r);if(i%1!=0)throw Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return s.DZQ(function(){return s.mgz(s.g9W(o,[n,i,r,r]),[2,3,1,0])})}(n,r,o),u=s.tGX(t(r)),e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:c,bias:u}),scale:(h=i+"/scale",p=s.tGX(t(r)),f=s.tGX(t(r)),e.push({paramPath:h+"/weights"},{paramPath:h+"/biases"}),{weights:p,biases:f})}}return{extractConvLayerParams:n,extractResidualLayerParams:function(t,e,r,o,i){return void 0===i&&(i=!1),{conv1:n((i?.5:1)*t,e,r,o+"/conv1"),conv2:n(t,e,r,o+"/conv2")}}}}(n,o),a=i.extractConvLayerParams,c=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),h=c(9216,32,3,"conv32_1"),p=c(9216,32,3,"conv32_2"),f=c(9216,32,3,"conv32_3"),l=c(36864,64,3,"conv64_down",!0),d=c(36864,64,3,"conv64_1"),v=c(36864,64,3,"conv64_2"),m=c(36864,64,3,"conv64_3"),g=c(147456,128,3,"conv128_down",!0),b=c(147456,128,3,"conv128_1"),y=c(147456,128,3,"conv128_2"),_=c(589824,256,3,"conv256_down",!0),w=c(589824,256,3,"conv256_1"),x=c(589824,256,3,"conv256_2"),P=c(589824,256,3,"conv256_down_out"),E=s.DZQ(function(){return s.mgz(s.KtR(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:h,conv32_2:p,conv32_3:f,conv64_down:l,conv64_1:d,conv64_2:v,conv64_3:m,conv128_down:g,conv128_1:b,conv128_2:y,conv256_down:_,conv256_1:w,conv256_2:x,conv256_down_out:P,fc:E},paramMappings:o}}(t)},e}(ti);function tG(t,e,n){return Object.assign({},t,{gender:e,genderProbability:n})}var tZ=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!=typeof t}))throw Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!=typeof t})))throw Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function t$(t,e,n){return s.DZQ(function(){var r=s.Xtf(t,e.filters,n,"same");return r=s.WQq(r,e.batch_norm_offset),s.zQh(r,0,6)})}function tK(t,e){return s.DZQ(function(){var n=t.shape[0];return{boxPredictionEncoding:s.tQQ(tu(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:s.tQQ(tu(t,e.class_predictor),[n,-1,3])}})}var tJ=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),tH=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return u(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("SsdMobilenetv1 - load model before inference");return s.DZQ(function(){var n,r,o,i,a,c,u=t.toBatchTensor(512,!1).toFloat(),h=(n=s.jbE(s.lKK(u,s.d_2(.007843137718737125)),s.d_2(1)),r=e.mobilenetv1,s.DZQ(function(){var t=null,e=t$(n,r.conv_0,[2,2]);if([r.conv_1,r.conv_2,r.conv_3,r.conv_4,r.conv_5,r.conv_6,r.conv_7,r.conv_8,r.conv_9,r.conv_10,r.conv_11,r.conv_12,r.conv_13].forEach(function(n,r){var o,i,a=r+1,c=[2,4,6,12].some(function(t){return t===a})?[2,2]:[1,1];o=e,i=n.depthwise_conv,e=t$(e=s.DZQ(function(){var t=s.Gl3(o,i.filters,c,"same");return t=s.$v7(t,i.batch_norm_mean,i.batch_norm_variance,i.batch_norm_offset,i.batch_norm_scale,.0010000000474974513),s.zQh(t,0,6)}),n.pointwise_conv,[1,1]),11===a&&(t=e)}),null===t)throw Error("mobileNetV1 - output of conv layer 11 is null");return{out:e,conv11:t}})),p=(o=h.out,i=h.conv11,a=e.prediction_layer,s.DZQ(function(){var t=t$(o,a.conv_0,[1,1]),e=t$(t,a.conv_1,[2,2]),n=t$(e,a.conv_2,[1,1]),r=t$(n,a.conv_3,[2,2]),c=t$(r,a.conv_4,[1,1]),u=t$(c,a.conv_5,[2,2]),h=t$(u,a.conv_6,[1,1]),p=t$(h,a.conv_7,[2,2]),f=tK(i,a.box_predictor_0),l=tK(o,a.box_predictor_1),d=tK(e,a.box_predictor_2),v=tK(r,a.box_predictor_3),m=tK(u,a.box_predictor_4),g=tK(p,a.box_predictor_5);return{boxPredictions:s.xWs([f.boxPredictionEncoding,l.boxPredictionEncoding,d.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:s.xWs([f.classPrediction,l.classPrediction,d.classPrediction,v.classPrediction,m.classPrediction,g.classPrediction],1)}})),f=p.boxPredictions,l=p.classPredictions;return c=e.output_layer,s.DZQ(function(){var t,e,n,r,o,i,a,u,h,p,d,v,m,g=f.shape[0],b=(t=s.tQQ(s.Vsq(c.extra_dim,[g,1,1]),[-1,4]),e=s.tQQ(f,[-1,4]),a=(n=s.K$i(s.mgz(t,[1,0])),r=[s.jbE(n[2],n[0]),s.jbE(n[3],n[1])],o=[s.WQq(n[0],s.y4m(r[0],s.d_2(2))),s.WQq(n[1],s.y4m(r[1],s.d_2(2)))],i={sizes:r,centers:o}).sizes,u=i.centers,h=s.K$i(s.mgz(e,[1,0])),p=s.y4m(s.lKK(s.oNF(s.y4m(h[2],s.d_2(5))),a[0]),s.d_2(2)),d=s.WQq(s.lKK(s.y4m(h[0],s.d_2(10)),a[0]),u[0]),v=s.y4m(s.lKK(s.oNF(s.y4m(h[3],s.d_2(5))),a[1]),s.d_2(2)),m=s.WQq(s.lKK(s.y4m(h[1],s.d_2(10)),a[1]),u[1]),s.mgz(s.t$z([s.jbE(d,p),s.jbE(m,v),s.WQq(d,p),s.WQq(m,v)]),[1,0]));b=s.tQQ(b,[g,b.shape[0]/g,4]);var y=s.ry7(s.dik(l,[0,0,1],[-1,-1,-1])),_=s.dik(y,[0,0,0],[-1,-1,1]);return _=s.tQQ(_,[g,_.shape[1]]),{boxes:s.K$i(b),scores:s.K$i(_)}})})},e.prototype.forward=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,te(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),p(this,void 0,void 0,function(){var n,r,o,i,a,s,c,u,h,p,l,d,v,m,g,b,y,_,w,x;return f(this,function(f){switch(f.label){case 0:return r=(n=new tJ(e)).maxResults,o=n.minConfidence,[4,te(t)];case 1:for(i=f.sent(),s=(a=this.forwardInput(i)).boxes,c=a.scores,u=s[0],h=c[0],p=1;p<s.length;p++)s[p].dispose(),c[p].dispose();return v=(d=Array).from,[4,h.data()];case 2:var P,E,S,D,M,F;return l=v.apply(d,[f.sent()]),P=u,E=r,S=o,D=Math.min(E,P.shape[0]),M=l.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>S}).sort(function(t,e){return e.score-t.score}),F=[],M.forEach(function(t){if(!(F.length>=D)){for(var e=t.score,n=F.length-1;n>=0;--n){var r=function(t,e,n){var r=t.arraySync(),o=Math.min(r[e][0],r[e][2]),i=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),c=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),h=Math.max(r[n][0],r[n][2]),p=Math.max(r[n][1],r[n][3]),f=(a-o)*(s-i),l=(h-c)*(p-u);if(f<=0||l<=0)return 0;var d=Math.max(Math.min(a,h)-Math.max(o,c),0)*Math.max(Math.min(s,p)-Math.max(i,u),0);return d/(f+l-d)}(P,t.boxIndex,F[n]);if(0!==r&&(t.score*=+(r<=.5),t.score<=S))break}e===t.score&&F.push(t.boxIndex)}}),m=F,g=i.getReshapedInputDimensions(0),y=(b=i.inputSize)/g.width,_=b/g.height,w=u.arraySync(),x=m.map(function(t){var e=[Math.max(0,w[t][0]),Math.min(1,w[t][2])].map(function(t){return t*_}),n=e[0],r=e[1],o=[Math.max(0,w[t][1]),Math.min(1,w[t][3])].map(function(t){return t*y}),a=o[0],s=o[1];return new T(l[t],new O(a,n,s-a,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),u.dispose(),h.dispose(),[2,x]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=tm(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,e+"/pointwise_conv")}}function i(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!v(i,3))throw Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return th(t,e),{params:a,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=tg(t),r=n.extractWeights,o=n.getRemainingWeights,i=function(t,e){function n(n,r,o,i,a){var c=s.g9W(t(n*r*o*o),[o,o,n,r]),u=s.tGX(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:c,bias:u}}function r(t,e,r,o){var i=n(t,e,r,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(n,o,i){var a,c,u,h,p,f;return{depthwise_conv:(a=i+"/depthwise_conv",c=s.g9W(t(9*n),[3,3,n,1]),u=s.tGX(t(n)),h=s.tGX(t(n)),p=s.tGX(t(n)),f=s.tGX(t(n)),e.push({paramPath:a+"/filters"},{paramPath:a+"/batch_norm_scale"},{paramPath:a+"/batch_norm_offset"},{paramPath:a+"/batch_norm_mean"},{paramPath:a+"/batch_norm_variance"}),{filters:c,batch_norm_scale:u,batch_norm_offset:h,batch_norm_mean:p,batch_norm_variance:f}),pointwise_conv:r(n,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,e),a=i.extractMobilenetV1Params,c=i.extractPredictionLayerParams,u=a(),h=c(),p=s.$_$(r(20472),[1,5118,4]);if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:h,output_layer:{extra_dim:p}},paramMappings:e}}(t)},e}(ti);!function(t){u(function(){return null!==t&&t.apply(this,arguments)||this},t)}(tH);var tX=[new x(.738768,.874946),new x(2.42204,2.65704),new x(4.30971,7.04493),new x(10.246,4.59428),new x(12.6868,11.8741)],tY=[new x(1.603231,2.094468),new x(6.041143,7.080126),new x(2.882459,3.518061),new x(4.266906,5.178857),new x(9.041765,10.66308)],t0=[117.001,114.697,97.404],t1=function(t){return"number"==typeof t};function t2(t){return s.DZQ(function(){var e=s.lKK(t,s.d_2(.10000000149011612));return s.WQq(s.VVh(s.jbE(t,e)),e)})}function t4(t,e){return s.DZQ(function(){var n=s.eVF(t,[[0,0],[1,1],[1,1],[0,0]]);return n=s.Xtf(n,e.conv.filters,[1,1],"valid"),n=s.jbE(n,e.bn.sub),n=s.lKK(n,e.bn.truediv),t2(n=s.WQq(n,e.conv.bias))})}function t3(t,e){return s.DZQ(function(){var n=s.eVF(t,[[0,0],[1,1],[1,1],[0,0]]);return n=s.wdz(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t2(n=s.WQq(n,e.bias))})}!function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"}(a||(a={}));var t5=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),t6=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return!function(t){if(!t)throw Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!t1(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(t){return"string"==typeof t}))throw Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(t){return t||{}}).every(function(t){return t1(t.x)&&t1(t.y)}))throw Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(t1)))throw Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),n._config=e,n}return u(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=t4(t,e.conv0);return n=t4(n=s.jgi(n,[2,2],[2,2],"same"),e.conv1),n=t4(n=s.jgi(n,[2,2],[2,2],"same"),e.conv2),n=t4(n=s.jgi(n,[2,2],[2,2],"same"),e.conv3),n=t4(n=s.jgi(n,[2,2],[2,2],"same"),e.conv4),n=t4(n=s.jgi(n,[2,2],[2,2],"same"),e.conv5),n=t4(n=s.jgi(n,[2,2],[1,1],"same"),e.conv6),tu(n=t4(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?t2(tu(t,e.conv0,"valid",!1)):t3(t,e.conv0);return n=t3(n=s.jgi(n,[2,2],[2,2],"same"),e.conv1),n=t3(n=s.jgi(n,[2,2],[2,2],"same"),e.conv2),n=t3(n=s.jgi(n,[2,2],[2,2],"same"),e.conv3),n=t3(n=s.jgi(n,[2,2],[2,2],"same"),e.conv4),n=t3(n=s.jgi(n,[2,2],[2,2],"same"),e.conv5),n=s.jgi(n,[2,2],[1,1],"same"),n=e.conv6?t3(n,e.conv6):n,tu(n=e.conv7?t3(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,r=this.params;if(!r)throw Error("TinyYolov2 - load model before inference");return s.DZQ(function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=n.config.meanRgb?M(o,n.config.meanRgb):o).div(s.d_2(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},e.prototype.forward=function(t,e){return p(this,void 0,void 0,function(){var n;return f(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,te(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),p(this,void 0,void 0,function(){var n,r,o,i,a,c,u,h,p,l,d,v,m=this;return f(this,function(f){switch(f.label){case 0:return r=(n=new t5(e)).inputSize,o=n.scoreThreshold,[4,te(t)];case 1:return i=f.sent(),[4,this.forwardInput(i,r)];case 2:return a=f.sent(),c=s.DZQ(function(){return s.K$i(a)[0].expandDims()}),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(c,i.getReshapedInputDimensions(0),o)];case 3:return h=f.sent(),a.dispose(),c.dispose(),p=h.map(function(t){return t.box}),l=h.map(function(t){return t.score}),d=h.map(function(t){return t.classScore}),v=h.map(function(t){return m.config.classes[t.label]}),[2,D(p.map(function(t){return t.rescale(r)}),l,this.config.iouThreshold,!0).map(function(t){return new S(l[t],d[t],v[t],p[t],u)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],o=function(t,e){var n=tm(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){var e;return{conv:r(t+"/conv"),bn:{sub:n((e=t+"/bn")+"/sub",1),truediv:n(e+"/truediv",1)}}},extractSeparableConvParams:tv(n)}}(t,r),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return th(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var o,i,a=tg(t),c=a.extractWeights,u=a.getRemainingWeights,h=[],p={extractConvParams:o=tp(c,h),extractConvWithBatchNormParams:function(t,e,n){var r,i,a;return{conv:o(t,e,3,n+"/conv"),bn:(r=n+"/bn",i=s.tGX(c(e)),a=s.tGX(c(e)),h.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:a})}},extractSeparableConvParams:td(c,h)},f=p.extractConvParams,l=p.extractConvWithBatchNormParams,d=p.extractSeparableConvParams;if(e.withSeparableConvs){var v=r[0],m=r[1],g=r[2],b=r[3],y=r[4],_=r[5],w=r[6],x=r[7],P=r[8],E=e.isFirstLayerConv2d?f(v,m,3,"conv0"):d(v,m,"conv0"),S=d(m,g,"conv1"),T=d(g,b,"conv2"),D=d(b,y,"conv3"),M=d(y,_,"conv4"),F=d(_,w,"conv5"),O=x?d(w,x,"conv6"):void 0,k=P?d(x,P,"conv7"):void 0,A=f(P||x||w,5*n,1,"conv8");i={conv0:E,conv1:S,conv2:T,conv3:D,conv4:M,conv5:F,conv6:O,conv7:k,conv8:A}}else{var v=r[0],m=r[1],g=r[2],b=r[3],y=r[4],_=r[5],w=r[6],x=r[7],P=r[8],E=l(v,m,"conv0"),S=l(m,g,"conv1"),T=l(g,b,"conv2"),D=l(b,y,"conv3"),M=l(y,_,"conv4"),F=l(_,w,"conv5"),O=l(w,x,"conv6"),k=l(x,P,"conv7"),A=f(P,5*n,1,"conv8");i={conv0:E,conv1:S,conv2:T,conv3:D,conv4:M,conv5:F,conv6:O,conv7:k,conv8:A}}if(0!==u().length)throw Error("weights remaing after extract: "+u().length);return{params:i,paramMappings:h}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return p(this,void 0,void 0,function(){var r,o,i,a,c,u,p,l,d,v,m,g,b,y,_,w,x,P,S,T,D,M,O,k,A,I,C,W,N,B=this;return f(this,function(f){switch(f.label){case 0:return a=(i=Math.max(r=e.width,o=e.height))/r,c=i/o,u=t.shape[1],p=this.config.anchors.length,d=(l=s.DZQ(function(){var e=t.reshape([u,u,p,B.boxEncodingSize]);return[e.slice([0,0,0,0],[u,u,p,4]),e.slice([0,0,0,4],[u,u,p,1]),B.withClassScores?s.Vs9(e.slice([0,0,0,5],[u,u,p,B.config.classes.length]),3):s.d_2(0)]}))[0],v=l[1],m=l[2],g=[],[4,v.array()];case 1:return b=f.sent(),[4,d.array()];case 2:y=f.sent(),_=0,f.label=3;case 3:if(!(_<u))return[3,12];w=0,f.label=4;case 4:if(!(w<u))return[3,11];x=0,f.label=5;case 5:if(!(x<p))return[3,10];if(P=F(b[_][w][x][0]),!(!n||P>n))return[3,9];if(S=(w+F(y[_][w][x][0]))/u*a,T=(_+F(y[_][w][x][1]))/u*c,D=Math.exp(y[_][w][x][2])*this.config.anchors[x].x/u*a,M=Math.exp(y[_][w][x][3])*this.config.anchors[x].y/u*c,O=S-D/2,k=T-M/2,A={row:_,col:w,anchor:x},!this.withClassScores)return[3,7];return[4,this.extractPredictedClass(m,A)];case 6:return N=f.sent(),[3,8];case 7:N={classScore:1,label:0},f.label=8;case 8:C=(I=N).classScore,W=I.label,g.push(h({box:new E(O,k,O+D,k+M),score:P,classScore:P*C,label:W},A)),f.label=9;case 9:return x++,[3,5];case 10:return w++,[3,4];case 11:return _++,[3,3];case 12:return d.dispose(),v.dispose(),m.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,e){return p(this,void 0,void 0,function(){var n,r,o,i;return f(this,function(a){switch(a.label){case 0:return n=e.row,r=e.col,o=e.anchor,[4,t.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map(function(t,e){return i[n][r][o][e]}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(ti),t8=function(t){function e(e){void 0===e&&(e=!0);var n=this,r=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:tY,meanRgb:t0}:{anchors:tX,withClassScores:!0});return t.call(this,r)||this}return u(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return p(this,void 0,void 0,function(){return f(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new T(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(t6),t7=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return u(e,t),e}(t5),t9=function(){function t(){}return t.prototype.then=function(t){return p(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},t.prototype.run=function(){return p(this,void 0,void 0,function(){return f(this,function(t){throw Error("ComposableTask - run is not implemented")})})},t}();function et(t,e){return Object.assign({},t,{descriptor:e})}function ee(t,e,n,r,o){return void 0===o&&(o=function(t){return t.alignedRect}),p(this,void 0,void 0,function(){var i,a,c,u,h;return f(this,function(p){switch(p.label){case 0:if(i=t.map(function(t){var e;return(e=t).detection instanceof T&&e.landmarks instanceof k&&e.unshiftedLandmarks instanceof k&&e.alignedRect instanceof T?o(t):t.detection}),c=r)return[3,5];if(!(e instanceof s.qYS))return[3,2];return[4,tr(e,i)];case 1:return u=p.sent(),[3,4];case 2:return[4,tn(e,i)];case 3:u=p.sent(),p.label=4;case 4:c=u,p.label=5;case 5:return[4,n(a=c)];case 6:return h=p.sent(),a.forEach(function(t){return t instanceof s.qYS&&t.dispose()}),[2,h]}})})}function en(t,e,n,r,o){return p(this,void 0,void 0,function(){var i=this;return f(this,function(a){return[2,ee([t],e,function(t){return p(i,void 0,void 0,function(){return f(this,function(e){return[2,n(t[0])]})})},r,o)]})})}function er(t,e){return{height:Math.floor(e[0]*t),width:Math.floor(e[1]*t)}}var eo=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o},!0)||this}return u(e,t),e}(P);function ei(t){return s.DZQ(function(){return s.lKK(s.jbE(t,s.d_2(127.5)),s.d_2(.0078125))})}function ea(t,e){return s.DZQ(function(){return s.WQq(s.VVh(t),s.lKK(e,s.HZy(s.VVh(s.HZy(t)))))})}function es(t,e,n){return void 0===n&&(n=!1),s.DZQ(function(){var r=tu(t,e.conv1,"valid");return r=ea(r,e.prelu1_alpha),r=ea(r=tu(r=s.jgi(r,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),r=ea(r=tu(r=n?r:s.jgi(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function ec(t,e,n){var r=n.width,o=n.height;return p(this,void 0,void 0,function(){var n,i,a,c=this;return f(this,function(u){switch(u.label){case 0:return n=U(t),[4,Promise.all(e.map(function(e){return p(c,void 0,void 0,function(){var r,o,i,a,s,c,u,h;return f(this,function(p){return o=(r=e.padAtBorders(t.height,t.width)).y,i=r.ey,a=r.x,s=r.ex,c=a-1,u=o-1,h=n.getImageData(c,u,s-c,i-u),[2,z.isNodejs()?X(h):createImageBitmap(h)]})})}))];case 1:return i=u.sent(),a=[],i.forEach(function(t){var e=U(J({width:r,height:o}));e.drawImage(t,0,0,r,o);for(var n=e.getImageData(0,0,r,o).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);a.push(i)}),[2,a.map(function(t){return s.DZQ(function(){return ei(s.mgz(s.g9W(t,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}var eu=function(t){function e(){return t.call(this,"Mtcnn")||this}return u(e,t),e.prototype.load=function(e){return p(this,void 0,void 0,function(){return f(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},e.prototype.loadFromDisk=function(e){return p(this,void 0,void 0,function(){return f(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),p(this,void 0,void 0,function(){var n,r,o,i,a,c,u,h,l,d,v,m,g,b,y,_,w,P,S,M;return f(this,function(F){switch(F.label){case 0:if(!(n=this.params))throw Error("Mtcnn - load model before inference");if(!(r=t.canvases[0]))throw Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=s.DZQ(function(){var t;return t=s.UG6(s.TaL.fromPixels(r)).toFloat(),s.DZQ(function(){return s.t$z(s.K$i(t,3).reverse(),3)})}),c=function(t){return a.dispose(),o.total=Date.now()-i,t},h=(u=a.shape.slice(1))[0],l=u[1],v=(d=new tZ(e)).minFaceSize,m=d.scaleFactor,g=d.maxNumScales,b=d.scoreThresholds,y=(d.scaleSteps||function(t,e,n){for(var r=n[0],o=n[1],i=12/t,a=[],s=Math.min(r,o)*i,c=0;s>=12;)a.push(i*Math.pow(e,c)),s*=e,c+=1;return a}(v,m,[h,l])).filter(function(t){var e=er(t,[h,l]);return Math.min(e.width,e.height)>12}).slice(0,g),o.scales=y,o.pyramid=y.map(function(t){return er(t,[h,l])}),_=Date.now(),[4,function(t,e,n,r,o){o.stage1=[];var i=e.map(function(e){return s.DZQ(function(){var n={scale:e},o=s.DZQ(function(){var n=er(e,t.shape.slice(1)),r=n.height,o=n.width,i=ei(s.Slp.resizeBilinear(t,[r,o]));return s.mgz(i,[0,2,1,3])}),i=Date.now(),a=s.DZQ(function(){var t=es(o,r,!0),e=tu(t,r.conv4_1,"valid"),n=s.UG6(s.T9B(e,3),3);return{prob:s.Vs9(s.jbE(e,n),3),regions:tu(t,r.conv4_2,"valid")}}),c=a.prob,u=a.regions;return n.pnet=Date.now()-i,{scoresTensor:s.K$i(s.K$i(c,3)[1])[0],regionsTensor:s.K$i(u)[0],scale:e,statsForScale:n}})}).map(function(t){var e=t.scoresTensor,r=t.regionsTensor,i=t.scale,a=t.statsForScale,s=function(t,e,n,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new x(s,a));return o.map(function(t){var r=new E(Math.round((2*t.y+1)/n),Math.round((2*t.x+1)/n),Math.round((2*t.y+12)/n),Math.round((2*t.x+12)/n)),o=i[t.y][t.x],a=e.arraySync();return{cell:r,score:o,region:new eo(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}})}(e,r,i,n);if(e.dispose(),r.dispose(),!s.length)return o.stage1.push(a),[];var c=Date.now(),u=D(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.5);return a.nms=Date.now()-c,a.numBoxes=u.length,o.stage1.push(a),u.map(function(t){return s[t]})}).reduce(function(t,e){return t.concat(e)},[]),a=[],c=[];if(i.length>0){var u=Date.now(),h=D(i.map(function(t){return t.cell}),i.map(function(t){return t.score}),.7);o.stage1_nms=Date.now()-u,c=h.map(function(t){return i[t].score}),a=h.map(function(t){return i[t]}).map(function(t){var e=t.cell,n=t.region;return new E(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()})}return{boxes:a,scores:c}}(a,y,b[0],n.pnet,o)];case 1:if(w=F.sent(),o.total_stage1=Date.now()-_,!w.boxes.length)return[2,c({results:[],stats:o})];return o.stage2_numInputBoxes=w.boxes.length,_=Date.now(),[4,function(t,e,n,r,o){return p(this,void 0,void 0,function(){var i,a,c,u,h,p,l,d,v,m,g,b,y,_;return f(this,function(f){switch(f.label){case 0:return i=Date.now(),[4,ec(t,e,{width:24,height:24})];case 1:return a=f.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),c=a.map(function(t){var e=s.DZQ(function(){var e=es(t,r),n=ea(tx(s.tQQ(e,[e.shape[0],r.fc1.weights.shape[0]]),r.fc1),r.prelu4_alpha),o=tx(n,r.fc2_1),i=s.UG6(s.T9B(o,1),1),a=s.Vs9(s.jbE(o,i),1),c=tx(n,r.fc2_2);return{scores:s.K$i(a,1)[1],regions:c}});return t.dispose(),e}),o.stage2_rnet=Date.now()-i,u=c.length>1?s.xWs(c.map(function(t){return t.scores})):c[0].scores,l=(p=Array).from,[4,u.data()];case 2:return h=l.apply(p,[f.sent()]),u.dispose(),v=(d=h.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx})).map(function(t){return e[t]}),m=d.map(function(t){return h[t]}),g=[],b=[],v.length>0&&(i=Date.now(),y=D(v,m,.7),o.stage2_nms=Date.now()-i,_=y.map(function(t){var e=c[d[t]].regions.arraySync();return new eo(e[0][0],e[0][1],e[0][2],e[0][3])}),b=y.map(function(t){return m[t]}),g=y.map(function(t,e){return v[t].calibrate(_[e])})),c.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:g,scores:b}]}})})}(r,w.boxes,b[1],n.rnet,o)];case 2:if(P=F.sent(),o.total_stage2=Date.now()-_,!P.boxes.length)return[2,c({results:[],stats:o})];return o.stage3_numInputBoxes=P.boxes.length,_=Date.now(),[4,function(t,e,n,r,o){return p(this,void 0,void 0,function(){var i,a,c,u,h,p,l,d,v,m,g,b,y,_,w;return f(this,function(f){switch(f.label){case 0:return i=Date.now(),[4,ec(t,e,{width:48,height:48})];case 1:return a=f.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),c=a.map(function(t){var e=s.DZQ(function(){var e=es(t,r);e=ea(e=tu(e=s.jgi(e,[2,2],[2,2],"same"),r.conv4,"valid"),r.prelu4_alpha);var n=ea(tx(s.tQQ(e,[e.shape[0],r.fc1.weights.shape[0]]),r.fc1),r.prelu5_alpha),o=tx(n,r.fc2_1),i=s.UG6(s.T9B(o,1),1),a=s.Vs9(s.jbE(o,i),1),c=tx(n,r.fc2_2),u=tx(n,r.fc2_3);return{scores:s.K$i(a,1)[1],regions:c,points:u}});return t.dispose(),e}),o.stage3_onet=Date.now()-i,u=c.length>1?s.xWs(c.map(function(t){return t.scores})):c[0].scores,l=(p=Array).from,[4,u.data()];case 2:return h=l.apply(p,[f.sent()]),u.dispose(),v=(d=h.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx})).map(function(t){var e=c[t].regions.arraySync();return new eo(e[0][0],e[0][1],e[0][2],e[0][3])}),m=d.map(function(t,n){return e[t].calibrate(v[n])}),g=d.map(function(t){return h[t]}),b=[],y=[],_=[],m.length>0&&(i=Date.now(),w=D(m,g,.7,!1),o.stage3_nms=Date.now()-i,b=w.map(function(t){return m[t]}),y=w.map(function(t){return g[t]}),_=w.map(function(t,e){return[,,,,,].fill(0).map(function(n,r){var o=c[t].points.arraySync();return new x(o[0][r]*(b[e].width+1)+b[e].left,o[0][r+5]*(b[e].height+1)+b[e].top)})})),c.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:b,scores:y,points:_}]}})})}(r,P.boxes,b[2],n.onet,o)];case 3:return S=F.sent(),o.total_stage3=Date.now()-_,M=S.boxes.map(function(t,e){return tF(B({},new T(S.scores[e],new O(t.left/l,t.top/h,t.width/l,t.height/h),{height:h,width:l})),new A(S.points[e].map(function(e){return e.sub(new x(t.left,t.top)).div(new x(t.width,t.height))}),{width:t.width,height:t.height}))}),[2,c({results:M,stats:o})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),p(this,void 0,void 0,function(){var n;return f(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,te(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),p(this,void 0,void 0,function(){var n;return f(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,te(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,n,r,o,i,a,s,c;return r=(n=function(t,e){var n=tm(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function o(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function i(t){return{conv1:r(t+"/conv1"),prelu1_alpha:n(t+"/prelu1_alpha",1),conv2:r(t+"/conv2"),prelu2_alpha:n(t+"/prelu2_alpha",1),conv3:r(t+"/conv3"),prelu3_alpha:n(t+"/prelu3_alpha",1)}}return{extractPNetParams:function(){var t=i("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return h(h({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=i("rnet"),e=o("rnet/fc1"),r=n("rnet/prelu4_alpha",1),a=o("rnet/fc2_1"),s=o("rnet/fc2_2");return h(h({},t),{fc1:e,prelu4_alpha:r,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i("onet"),e=r("onet/conv4"),a=n("onet/prelu4_alpha",1),s=o("onet/fc1"),c=n("onet/prelu5_alpha",1),u=o("onet/fc2_1"),p=o("onet/fc2_2"),f=o("onet/fc2_3");return h(h({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:p,fc2_3:f})}}}(t,e=[])).extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),s=o(),c=i(),th(t,e),{params:{pnet:a,rnet:s,onet:c},paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=tg(t),n=e.extractWeights,r=e.getRemainingWeights,o=[],i=function(t,e){var n=tp(t,e),r=tf(t,e);function o(n,r){var o=s.tGX(t(n));return e.push({paramPath:r}),o}function i(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:o(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:o(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:o(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=i([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return h(h({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=i([3,28,48,64],"rnet",!0),e=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),a=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return h(h({},t),{fc1:e,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),a=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),c=o(256,"onet/prelu5_alpha"),u=r(256,2,"onet/fc2_1"),p=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return h(h({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:p,fc2_3:f})}}}(n,o),a=i.extractPNetParams,c=i.extractRNetParams,u=i.extractONetParams,p=a(),f=c(),l=u();if(0!==r().length)throw Error("weights remaing after extract: "+r().length);return{params:{pnet:p,rnet:f,onet:l},paramMappings:o}}(t)},e}(ti),eh=[new x(1.603231,2.094468),new x(6.041143,7.080126),new x(2.882459,3.518061),new x(4.266906,5.178857),new x(9.041765,10.66308)],ep=[117.001,114.697,97.404],ef=function(t){function e(){var e=this;return t.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:eh,meanRgb:ep,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return u(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return p(this,void 0,void 0,function(){return f(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new T(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(t6),el={ssdMobilenetv1:new tH,tinyFaceDetector:new ef,tinyYolov2:new t8,mtcnn:new eu,faceLandmark68Net:new tN,faceLandmark68TinyNet:new tL,faceRecognitionNet:new tq,faceExpressionNet:new tD,ageGenderNet:new tC};function ed(t,e){return Object.assign({},t,{age:e})}var ev=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return u(e,t),e}(t9),em=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e,n=this;return f(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,ee(t=r.sent(),this.input,function(t){return p(n,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return el.faceExpressionNet.predictExpressions(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){return tM(t,e[n])})]}})})},e.prototype.withAgeAndGender=function(){return new ew(this,this.input)},e}(ev),eg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e;return f(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:if(!(t=n.sent()))return[2];return[4,en(t,this.input,function(t){return el.faceExpressionNet.predictExpressions(t)},this.extractedFaces)];case 2:return e=n.sent(),[2,tM(t,e)]}})})},e.prototype.withAgeAndGender=function(){return new ex(this,this.input)},e}(ev),eb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.withAgeAndGender=function(){return new eP(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eT(this,this.input)},e}(em),ey=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.withAgeAndGender=function(){return new eE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new eD(this,this.input)},e}(eg),e_=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return u(e,t),e}(t9),ew=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e,n=this;return f(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,ee(t=r.sent(),this.input,function(t){return p(n,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return el.ageGenderNet.predictAgeAndGender(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){var r=e[n],o=r.age;return ed(tG(t,r.gender,r.genderProbability),o)})]}})})},e.prototype.withFaceExpressions=function(){return new em(this,this.input)},e}(e_),ex=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e,n,r,o;return f(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:if(!(t=i.sent()))return[2];return[4,en(t,this.input,function(t){return el.ageGenderNet.predictAgeAndGender(t)},this.extractedFaces)];case 2:return n=(e=i.sent()).age,r=e.gender,o=e.genderProbability,[2,ed(tG(t,r,o),n)]}})})},e.prototype.withFaceExpressions=function(){return new eg(this,this.input)},e}(e_),eP=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.withFaceExpressions=function(){return new eb(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eT(this,this.input)},e}(ew),eE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.withFaceExpressions=function(){return new ey(this,this.input)},e.prototype.withFaceDescriptor=function(){return new eD(this,this.input)},e}(ex),eS=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return u(e,t),e}(t9),eT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,ee(t=e.sent(),this.input,function(t){return Promise.all(t.map(function(t){return el.faceRecognitionNet.computeFaceDescriptor(t)}))},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,e.sent().map(function(e,n){return et(t[n],e)})]}})})},e.prototype.withFaceExpressions=function(){return new eb(this,this.input)},e.prototype.withAgeAndGender=function(){return new eP(this,this.input)},e}(eS),eD=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e;return f(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:if(!(t=n.sent()))return[2];return[4,en(t,this.input,function(t){return el.faceRecognitionNet.computeFaceDescriptor(t)},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return e=n.sent(),[2,et(t,e)]}})})},e.prototype.withFaceExpressions=function(){return new ey(this,this.input)},e.prototype.withAgeAndGender=function(){return new eE(this,this.input)},e}(eS),eM=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.useTinyLandmarkNet=r,o}return u(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?el.faceLandmark68TinyNet:el.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(t9),eF=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e,n,r,o,i=this;return f(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:if(e=(t=a.sent()).map(function(t){return t.detection}),!(this.input instanceof s.qYS))return[3,3];return[4,tr(this.input,e)];case 2:return r=a.sent(),[3,5];case 3:return[4,tn(this.input,e)];case 4:r=a.sent(),a.label=5;case 5:return[4,Promise.all((n=r).map(function(t){return i.landmarkNet.detectLandmarks(t)}))];case 6:return o=a.sent(),n.forEach(function(t){return t instanceof s.qYS&&t.dispose()}),[2,t.map(function(t,e){return tF(t,o[e])})]}})})},e.prototype.withFaceExpressions=function(){return new eb(this,this.input)},e.prototype.withAgeAndGender=function(){return new eP(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eT(this,this.input)},e}(eM),eO=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e,n,r,o;return f(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:if(!(t=i.sent()))return[2];if(e=t.detection,!(this.input instanceof s.qYS))return[3,3];return[4,tr(this.input,[e])];case 2:return r=i.sent(),[3,5];case 3:return[4,tn(this.input,[e])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=i.sent(),n.forEach(function(t){return t instanceof s.qYS&&t.dispose()}),[2,tF(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new ey(this,this.input)},e.prototype.withAgeAndGender=function(){return new eE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new eD(this,this.input)},e}(eM),ek=function(t){function e(e,n){void 0===n&&(n=new tJ);var r=t.call(this)||this;return r.input=e,r.options=n,r}return u(e,t),e}(t9),ej=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e,n,r;return f(this,function(o){switch(o.label){case 0:if(t=this,e=t.input,!((n=t.options)instanceof tZ))return[3,2];return[4,el.mtcnn.forward(e,n)];case 1:return[2,o.sent().map(function(t){return t.detection})];case 2:if(!(r=n instanceof t7?function(t){return el.tinyFaceDetector.locateFaces(t,n)}:n instanceof tJ?function(t){return el.ssdMobilenetv1.locateFaces(t,n)}:n instanceof t5?function(t){return el.tinyYolov2.locateFaces(t,n)}:null))throw Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return p(t,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.run()];case 1:return[2,e(t.sent().map(function(t){return B({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new eF(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new em(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new ew(this.runAndExtendWithFaceDetections(),this.input)},e}(ek);function eA(t,e){return void 0===e&&(e=new tJ),new ej(t,e)}!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}u(e,t),e.prototype.run=function(){return p(this,void 0,void 0,function(){var t,e;return f(this,function(n){switch(n.label){case 0:return[4,new ej(this.input,this.options)];case 1:return e=(t=n.sent())[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return p(t,void 0,void 0,function(){var t;return f(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return[2,e((t=n.sent())?B({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new eO(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new eg(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new ex(this.runAndExtendWithFaceDetection(),this.input)}}(ek),!function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(t){if(t instanceof N)return t;if(t instanceof Float32Array)return new N(o(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new N(o(),[t.descriptor]);throw Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map(function(e){return function(t,e){if(t.length!==e.length)throw Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(t,e){return t-r[e]}).reduce(function(t,e){return t+Math.pow(e,2)},0))}(e,t)}).reduce(function(t,e){return t+e},0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors;return new C(n.label,e.computeMeanDistance(t,r))}).reduce(function(t,e){return t.distance<e.distance?t:e})},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new C("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map(function(t){return N.fromJSON(t)}),e.distanceThreshold)}}()}}]);