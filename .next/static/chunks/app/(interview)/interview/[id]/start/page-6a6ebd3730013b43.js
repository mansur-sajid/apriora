(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{18082:()=>{},22319:(e,t,n)=>{"use strict";n.d(t,{AG:()=>d,fi:()=>p,cr:()=>m,MO:()=>y,NH:()=>v,bC:()=>_,wc:()=>F,RB:()=>E,AY:()=>f,OD:()=>g,bE:()=>k,Br:()=>A,LF:()=>I,jb:()=>R,EL:()=>j,n6:()=>D});var r=n(5041),a=n(19373);class o extends Error{constructor(e="Validation Error",t=500,n={}){var r,a;super(e),this.name=this.constructor.name,this.status=t,this.message=e,n&&(this.meta=n),null===(r=(a=Error).captureStackTrace)||void 0===r||r.call(a,this,this.constructor)}}var i=n(58811),s=n(95120),c=n.n(s);let u=new i.l4("https://prototype-apriora.duckdns.org/graphql",{fetch:c(),credentials:"include"});function l(e,t,n){return async()=>u.request(e,t,n).catch(e=>{let{response:t}=e;if((null==t?void 0:t.status)===401)return{};throw new o(null==t?void 0:t.error,null==t?void 0:t.status,{response:t})})}var d=function(e){return e.FourWeeksNotice="FOUR_WEEKS_NOTICE",e.Immediate="IMMEDIATE",e.ThreeWeeksNotice="THREE_WEEKS_NOTICE",e.TwoWeeksNotice="TWO_WEEKS_NOTICE",e}({}),p=function(e){return e.Contract="CONTRACT",e.FullTime="FULL_TIME",e.PartTime="PART_TIME",e}({}),m=function(e){return e.Hourly="HOURLY",e.Unit="UNIT",e}({}),y=function(e){return e.Archived="ARCHIVED",e.Draft="DRAFT",e.Published="PUBLISHED",e}({}),v=function(e){return e.Hybrid="HYBRID",e.OnSite="ON_SITE",e.Remote="REMOTE",e}({});let b="\n    mutation CreateJobPostApplication($data: JobPostApplicationCreateInput!) {\n  createJobPostApplication(data: $data) {\n    ... on JobPostApplicationType {\n      id\n    }\n    ... on GraphQLErrorType {\n      message\n      code\n    }\n  }\n}\n    ",f=e=>(0,r.n)({mutationKey:["CreateJobPostApplication"],mutationFn:e=>l(b,e)(),...e});f.getKey=()=>["CreateJobPostApplication"],f.fetcher=(e,t)=>l(b,e,t);let h="\n    mutation CreateJobPost($data: JobPostCreateInput!) {\n  jobPostCreate(data: $data) {\n    id\n  }\n}\n    ",g=e=>(0,r.n)({mutationKey:["CreateJobPost"],mutationFn:e=>l(h,e)(),...e});g.getKey=()=>["CreateJobPost"],g.fetcher=(e,t)=>l(h,e,t);let w="\n    mutation getInterviewSumary($interviewId: UUID!) {\n  getSummary(interviewId: $interviewId) {\n    summary\n    communication\n    cultureFit\n    curiosity\n    experience\n    overallScore\n    problemSolving\n    technicalAbility\n  }\n}\n    ",A=e=>(0,r.n)({mutationKey:["getInterviewSumary"],mutationFn:e=>l(w,e)(),...e});A.getKey=()=>["getInterviewSumary"],A.fetcher=(e,t)=>l(w,e,t);let P="\n    query Interview($id: GlobalID!) {\n  interviews(filters: {id: $id}) {\n    edges {\n      node {\n        id\n        questions {\n          question\n        }\n        user {\n          name\n        }\n        jobPostApplication {\n          jobPost {\n            company {\n              name\n            }\n            title\n          }\n        }\n      }\n    }\n  }\n}\n    ",I=(e,t)=>(0,a.I)({queryKey:["Interview",e],queryFn:l(P,e),...t});I.getKey=e=>["Interview",e],I.fetcher=(e,t)=>l(P,e,t);let T="\n    query AppliedJobs {\n  appliedJobPosts {\n    jobPost {\n      availibility\n      applicationLimit\n      city\n      country\n      company {\n        name\n      }\n      workStartDate\n      workMode\n      updatedAt\n      totalApplications\n      title\n      status\n      startDate\n      salary\n      payType\n      id\n      firstPublishedAt\n      expiresAt\n      endDate\n      employmentType\n      description\n      department\n      deletedAt\n      createdAt\n    }\n    interview {\n      scheduledAt\n    }\n  }\n}\n    ",E=(e,t)=>(0,a.I)({queryKey:void 0===e?["AppliedJobs"]:["AppliedJobs",e],queryFn:l(T,e),...t});E.getKey=e=>void 0===e?["AppliedJobs"]:["AppliedJobs",e],E.fetcher=(e,t)=>l(T,e,t);let S="\n    query getAllSummaries {\n  summary {\n    summary {\n      summary\n    }\n    jobPost {\n      title\n    }\n    user {\n      email\n      lastName\n      firstName\n    }\n    interview {\n      scheduledAt\n    }\n  }\n}\n    ",k=(e,t)=>(0,a.I)({queryKey:void 0===e?["getAllSummaries"]:["getAllSummaries",e],queryFn:l(S,e),...t});k.getKey=e=>void 0===e?["getAllSummaries"]:["getAllSummaries",e],k.fetcher=(e,t)=>l(S,e,t);let x="\n    query JobsPosts {\n  jobPosts {\n    applicationLimit\n    availibility\n    city\n    company {\n      name\n    }\n    country\n    createdAt\n    deletedAt\n    department\n    description\n    employmentType\n    endDate\n    expiresAt\n    firstPublishedAt\n    id\n    payType\n    startDate\n    salary\n    status\n    title\n    totalApplications\n    updatedAt\n    workMode\n    workStartDate\n  }\n}\n    ",R=(e,t)=>(0,a.I)({queryKey:void 0===e?["JobsPosts"]:["JobsPosts",e],queryFn:l(x,e),...t});R.getKey=e=>void 0===e?["JobsPosts"]:["JobsPosts",e],R.fetcher=(e,t)=>l(x,e,t);let J="\n    query UnappliedJobs {\n  unappliedJobPosts {\n    applicationLimit\n    availibility\n    city\n    company {\n      name\n    }\n    country\n    createdAt\n    deletedAt\n    department\n    description\n    employmentType\n    endDate\n    expiresAt\n    firstPublishedAt\n    id\n    payType\n    startDate\n    salary\n    status\n    title\n    totalApplications\n    updatedAt\n    workMode\n    workStartDate\n  }\n}\n    ",j=(e,t)=>(0,a.I)({queryKey:void 0===e?["UnappliedJobs"]:["UnappliedJobs",e],queryFn:l(J,e),...t});j.getKey=e=>void 0===e?["UnappliedJobs"]:["UnappliedJobs",e],j.fetcher=(e,t)=>l(J,e,t);let N="\n    query UpcomingInterview {\n  upcomingInterview {\n    id\n    scheduledAt\n    jobPostApplication {\n      jobPost {\n        applicationLimit\n        availibility\n        city\n        company {\n          name\n        }\n        country\n        createdAt\n        deletedAt\n        department\n        description\n        employmentType\n        endDate\n        expiresAt\n        firstPublishedAt\n        id\n        payType\n        startDate\n        salary\n        status\n        title\n        totalApplications\n        updatedAt\n        workMode\n        workStartDate\n      }\n    }\n  }\n}\n    ",D=(e,t)=>(0,a.I)({queryKey:void 0===e?["UpcomingInterview"]:["UpcomingInterview",e],queryFn:l(N,e),...t});D.getKey=e=>void 0===e?["UpcomingInterview"]:["UpcomingInterview",e],D.fetcher=(e,t)=>l(N,e,t);var C=n(44134).hp;function F(e,t){return t?C.from("".concat(e,":").concat(t)).toString("base64"):""}function _(e){var t;return e?null===(t=C.from(e,"base64").toString("ascii").split(":"))||void 0===t?void 0:t[1]:""}},40745:()=>{},41354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n(95155),a=n(12115),o=n(35695),i=n(33764),s=n(50438),c=n(31530),u=n(74931),l=n(84477),d=n(87110),p=n(54581),m=n(3127),y=n(29709),v=n(22319);function b(){var e;let{id:t}=(0,o.useParams)(),[n,b]=(0,a.useState)([]),[f,h]=(0,a.useState)(!1),[g,w]=(0,a.useState)(!1),[A,P]=(0,a.useState)(!1),I=(0,a.useRef)(null),T=(0,a.useRef)([]),E=(0,a.useRef)(null),S=(0,a.useRef)([]),k=(0,a.useRef)(!1),x=(0,a.useRef)(null),R=(0,a.useRef)(null),J=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(null),D=(0,a.useRef)(null),C=(0,a.useRef)(null),F=(0,a.useRef)(!1),{data:_}=(0,v.LF)({id:(0,v.wc)("Interview",String(t))}),q=(0,o.useRouter)(),U=null==_?void 0:null===(e=_.interviews.edges[0])||void 0===e?void 0:e.node;console.log("Interview data:",U);let K=new i.l7({apiKey:"43b24f3a62744557bfdc6813f3211783"});(0,a.useEffect)(()=>{let e=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});j.current=e,N.current&&(N.current.srcObject=e,N.current.onloadedmetadata=()=>{var e;null===(e=N.current)||void 0===e||e.play()}),t()}catch(e){console.error("Error accessing camera:",e),c.Ay.error("Camera access denied. Please enable camera for this interview.")}},t=async()=>{if(!N.current||N.current.readyState<2){D.current=setTimeout(t,100);return}try{let e=await s.R(N.current,new s.ex).withFaceLandmarks();if(e.length>0){let t=e[0].landmarks.getNose()[3];n(t.x,N.current.videoWidth)}else r()}catch(e){console.error("Face detection error:",e)}D.current=setTimeout(t,300)},n=(e,t)=>{Math.abs(e-t/2)>.25*t?r():(C.current=null,(F.current||A)&&(F.current=!1,P(!1),c.Ay.dismiss()))},r=()=>{let e=Date.now();C.current?e-C.current>5e3&&!F.current&&(c.Ay.error("Please focus on the interview and look at the screen"),F.current=!0,P(!0)):C.current=e};return(async()=>{try{s.B0.tinyFaceDetector.loadFromUri("/models"),s.B0.faceLandmark68Net.loadFromUri("/models"),e()}catch(e){console.error("Error loading face detection models:",e)}})(),()=>{D.current&&clearTimeout(D.current),j.current&&j.current.getTracks().forEach(e=>e.stop())}},[]),(0,a.useEffect)(()=>{x.current=new Audio,x.current.onended=O;let e=new WebSocket("wss://prototype-apriora.duckdns.org/ws/interview/".concat(t,"/"));return e.onopen=()=>console.log("✅ WebSocket connected"),e.onmessage=e=>{let n=JSON.parse(e.data);if("text_message"===n.type&&b(e=>[...e,{type:n.is_ai?"bot":"user",text:n.text}]),"tts_audio"===n.type){if(S.current.push({audio:n.audio_chunk,messageType:n.message_type}),"question"===n.message_type&&(R.current=n.message_type),"interview_complete"===n.message_type){let e=()=>{k.current||0!==S.current.length||(L(),q.push("/interview/".concat(t,"/completed")))},n=setInterval(()=>{k.current||0!==S.current.length||(clearInterval(n),e())},500);e()}k.current||M()}},e.onclose=()=>console.log("❌ WebSocket disconnected"),E.current=e,()=>{L(),e.close()}},[t]),(0,a.useEffect)(()=>{let e=e=>{"Space"===e.code&&g&&H()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g]);let O=()=>{k.current=!1,S.current.length>0?M():(R.current=null,W())},L=()=>{x.current&&(x.current.pause(),x.current.onended=null),H(),J.current&&clearTimeout(J.current),j.current&&j.current.getTracks().forEach(e=>e.stop()),C.current=null,F.current=!1,P(!1),c.Ay.dismiss()},M=()=>{if(0===S.current.length||k.current)return;let e=S.current.shift();e&&x.current&&(k.current=!0,x.current.src="data:audio/mp3;base64,".concat(e.audio),x.current.play().catch(e=>{console.error("Audio playback failed:",e),k.current=!1,M()}))},W=async()=>{try{if(g)return;let e=await navigator.mediaDevices.getUserMedia({audio:!0});j.current=e;let t=new MediaRecorder(e);I.current=t,T.current=[],t.ondataavailable=e=>{e.data.size>0&&(T.current.push(e.data),J.current&&clearTimeout(J.current),J.current=setTimeout(()=>{H()},3e3))},t.onstop=async()=>{let e=new Blob(T.current,{type:"audio/wav"});await $(e),J.current&&clearTimeout(J.current)},t.start(250),w(!0)}catch(e){console.error("Error starting recording:",e),w(!1)}},H=()=>{I.current&&"inactive"!==I.current.state&&(I.current.stop(),w(!1)),j.current&&(j.current.getTracks().forEach(e=>e.stop()),j.current=null)},$=async e=>{h(!0);try{let t=new FileReader;t.onloadend=async()=>{var e;let n=t.result,r=await K.transcripts.transcribe({audio:n});if("error"===r.status){console.error("\uD83D\uDEA8 Transcription error:",r.error);return}let a=r.text;b(e=>[...e,{type:"user",text:a}]),(null===(e=E.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&E.current.send(JSON.stringify({response:a}))},t.readAsDataURL(e)}catch(e){console.error("Error processing audio:",e)}finally{h(!1)}};return(0,r.jsxs)(p.default,{className:"w-screen p-6 flex gap-5 h-screen",style:{backgroundColor:"#101a25"},children:[(0,r.jsxs)(p.default,{className:"w-3/4",children:[(0,r.jsx)(u.InterviewHeader,{position:null==U?void 0:U.jobPostApplication.jobPost.title}),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(l.VideoFeed,{videoRef:N,isAway:A})}),(0,r.jsx)("div",{className:"flex justify-center mt-3",children:(0,r.jsxs)(m.default,{onClick:()=>{g&&H()},sx:{backgroundColor:g?"rgba(255, 0, 0, 0.2)":"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:g?"rgba(255, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"},borderRadius:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",width:"200px"},children:[(0,r.jsx)(y.default,{className:"text-white"}),g&&(0,r.jsx)("span",{className:"ml-2 text-white text-xs",children:"Stop Recording"})]})})]}),(0,r.jsx)(p.default,{className:"w-1/4",children:(0,r.jsx)(d.ChatTranscript,{messages:n,loading:f,isRecording:g,position:null==U?void 0:U.jobPostApplication.jobPost.title,company:null==U?void 0:U.jobPostApplication.jobPost.company.name})})]})}},90253:(e,t,n)=>{Promise.resolve().then(n.bind(n,41354))},97318:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[122,522,860,992,375,667,926,234,732,328,441,684,358],()=>t(90253)),_N_E=e.O()}]);