(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{18082:()=>{},22319:(e,t,n)=>{"use strict";n.d(t,{AG:()=>d,fi:()=>p,cr:()=>m,MO:()=>y,NH:()=>g,bC:()=>G,wc:()=>B,RB:()=>q,nF:()=>A,AY:()=>b,OD:()=>I,bE:()=>$,Br:()=>k,_L:()=>E,FM:()=>R,LF:()=>x,lI:()=>C,jb:()=>L,GF:()=>j,EL:()=>O,n6:()=>z});var r=n(5041),a=n(19373);class o extends Error{constructor(e="Validation Error",t=500,n={}){var r,a;super(e),this.name=this.constructor.name,this.status=t,this.message=e,n&&(this.meta=n),null===(r=(a=Error).captureStackTrace)||void 0===r||r.call(a,this,this.constructor)}}var i=n(58811),s=n(95120),l=n.n(s);let c=new i.l4("https://prototype-apriora.duckdns.org/graphql",{fetch:l(),credentials:"include"});function u(e,t,n){return async()=>c.request(e,t,n).catch(e=>{let{response:t}=e;if((null==t?void 0:t.status)===401)return{};throw new o(null==t?void 0:t.error,null==t?void 0:t.status,{response:t})})}var d=function(e){return e.FourWeeksNotice="FOUR_WEEKS_NOTICE",e.Immediate="IMMEDIATE",e.ThreeWeeksNotice="THREE_WEEKS_NOTICE",e.TwoWeeksNotice="TWO_WEEKS_NOTICE",e}({}),p=function(e){return e.Contract="CONTRACT",e.FullTime="FULL_TIME",e.PartTime="PART_TIME",e}({}),m=function(e){return e.Hourly="HOURLY",e.Unit="UNIT",e}({}),y=function(e){return e.Archived="ARCHIVED",e.Draft="DRAFT",e.Published="PUBLISHED",e}({}),g=function(e){return e.Hybrid="HYBRID",e.OnSite="ON_SITE",e.Remote="REMOTE",e}({});let v="\n    mutation CreateJobPostApplication($data: JobPostApplicationCreateInput!) {\n  createJobPostApplication(data: $data) {\n    ... on JobPostApplicationType {\n      id\n    }\n    ... on GraphQLErrorType {\n      message\n      code\n    }\n  }\n}\n    ",b=e=>(0,r.n)({mutationKey:["CreateJobPostApplication"],mutationFn:e=>u(v,e)(),...e});b.getKey=()=>["CreateJobPostApplication"],b.fetcher=(e,t)=>u(v,e,t);let h="\n    mutation AbortUpload($uploadId: String!, $key: String!) {\n  abortUpload(uploadId: $uploadId, key: $key)\n}\n    ",f=e=>(0,r.n)({mutationKey:["AbortUpload"],mutationFn:e=>u(h,e)(),...e});f.getKey=()=>["AbortUpload"],f.fetcher=(e,t)=>u(h,e,t);let w="\n    mutation CompleteUpload($uploadId: String!, $key: String!, $parts: [PartETagInput!]!) {\n  completeUpload(uploadId: $uploadId, key: $key, parts: $parts)\n}\n    ",A=e=>(0,r.n)({mutationKey:["CompleteUpload"],mutationFn:e=>u(w,e)(),...e});A.getKey=()=>["CompleteUpload"],A.fetcher=(e,t)=>u(w,e,t);let S="\n    mutation CreateJobPost($data: JobPostCreateInput!) {\n  jobPostCreate(data: $data) {\n    id\n  }\n}\n    ",I=e=>(0,r.n)({mutationKey:["CreateJobPost"],mutationFn:e=>u(S,e)(),...e});I.getKey=()=>["CreateJobPost"],I.fetcher=(e,t)=>u(S,e,t);let P="\n    mutation getInterviewSumary($interviewId: UUID!) {\n  getSummary(interviewId: $interviewId) {\n    summary\n    communication\n    cultureFit\n    curiosity\n    experience\n    overallScore\n    problemSolving\n    technicalAbility\n  }\n}\n    ",k=e=>(0,r.n)({mutationKey:["getInterviewSumary"],mutationFn:e=>u(P,e)(),...e});k.getKey=()=>["getInterviewSumary"],k.fetcher=(e,t)=>u(P,e,t);let U="\n    mutation GetUploadPartUrl($uploadId: String!, $partNumber: Int!, $key: String!) {\n  getUploadPartUrl(uploadId: $uploadId, partNumber: $partNumber, key: $key)\n}\n    ",E=e=>(0,r.n)({mutationKey:["GetUploadPartUrl"],mutationFn:e=>u(U,e)(),...e});E.getKey=()=>["GetUploadPartUrl"],E.fetcher=(e,t)=>u(U,e,t);let T="\n    mutation InitiateUpload($filename: String!, $contentType: String!) {\n  initiateUpload(filename: $filename, contentType: $contentType) {\n    uploadId\n    key\n  }\n}\n    ",R=e=>(0,r.n)({mutationKey:["InitiateUpload"],mutationFn:e=>u(T,e)(),...e});R.getKey=()=>["InitiateUpload"],R.fetcher=(e,t)=>u(T,e,t);let K="\n    query Interview($id: GlobalID!) {\n  interviews(filters: {id: $id}) {\n    edges {\n      node {\n        id\n        questions {\n          question\n        }\n        user {\n          name\n        }\n        jobPostApplication {\n          jobPost {\n            company {\n              name\n            }\n            title\n          }\n        }\n      }\n    }\n  }\n}\n    ",x=(e,t)=>(0,a.I)({queryKey:["Interview",e],queryFn:u(K,e),...t});x.getKey=e=>["Interview",e],x.fetcher=(e,t)=>u(K,e,t);let F="\n    query JobSeekerKpis {\n  jobSeekerKpis {\n    followUps\n    followUpsChangePercent\n    interviewsAttended\n    interviewsAttendedChangePercent\n    jobsApplied\n    jobsAppliedChangePercent\n    pendingInterviews\n    pendingInterviewsChangePercent\n  }\n}\n    ",C=(e,t)=>(0,a.I)({queryKey:void 0===e?["JobSeekerKpis"]:["JobSeekerKpis",e],queryFn:u(F,e),...t});C.getKey=e=>void 0===e?["JobSeekerKpis"]:["JobSeekerKpis",e],C.fetcher=(e,t)=>u(F,e,t);let J="\n    query RecruiterKpis {\n  recruiterKpis {\n    interviewed\n    interviewedChangePercent\n    jobsPosted\n    jobsPostedChangePercent\n    totalApplicants\n    totalApplicantsChangePercent\n  }\n}\n    ",j=(e,t)=>(0,a.I)({queryKey:void 0===e?["RecruiterKpis"]:["RecruiterKpis",e],queryFn:u(J,e),...t});j.getKey=e=>void 0===e?["RecruiterKpis"]:["RecruiterKpis",e],j.fetcher=(e,t)=>u(J,e,t);let N="\n    query AppliedJobs {\n  appliedJobPosts {\n    jobPost {\n      availibility\n      applicationLimit\n      city\n      country\n      company {\n        name\n      }\n      workStartDate\n      workMode\n      updatedAt\n      totalApplications\n      title\n      status\n      startDate\n      minSalary\n      maxSalary\n      payType\n      id\n      firstPublishedAt\n      expiresAt\n      endDate\n      employmentType\n      description\n      department\n      deletedAt\n      createdAt\n    }\n    interview {\n      scheduledAt\n      user {\n        name\n      }\n    }\n  }\n}\n    ",q=(e,t)=>(0,a.I)({queryKey:void 0===e?["AppliedJobs"]:["AppliedJobs",e],queryFn:u(N,e),...t});q.getKey=e=>void 0===e?["AppliedJobs"]:["AppliedJobs",e],q.fetcher=(e,t)=>u(N,e,t);let D="\n    query getAllSummaries {\n  summary {\n    summary {\n      summary\n    }\n    jobPost {\n      title\n    }\n    user {\n      email\n      lastName\n      firstName\n    }\n    interview {\n      id\n      scheduledAt\n    }\n  }\n}\n    ",$=(e,t)=>(0,a.I)({queryKey:void 0===e?["getAllSummaries"]:["getAllSummaries",e],queryFn:u(D,e),...t});$.getKey=e=>void 0===e?["getAllSummaries"]:["getAllSummaries",e],$.fetcher=(e,t)=>u(D,e,t);let _="\n    query JobsPosts {\n  jobPosts {\n    applicationLimit\n    availibility\n    city\n    company {\n      name\n    }\n    country\n    createdAt\n    deletedAt\n    department\n    description\n    employmentType\n    endDate\n    expiresAt\n    firstPublishedAt\n    id\n    payType\n    startDate\n    minSalary\n    maxSalary\n    status\n    title\n    totalApplications\n    updatedAt\n    workMode\n    workStartDate\n  }\n}\n    ",L=(e,t)=>(0,a.I)({queryKey:void 0===e?["JobsPosts"]:["JobsPosts",e],queryFn:u(_,e),...t});L.getKey=e=>void 0===e?["JobsPosts"]:["JobsPosts",e],L.fetcher=(e,t)=>u(_,e,t);let M="\n    query UnappliedJobs {\n  unappliedJobPosts {\n    applicationLimit\n    availibility\n    city\n    company {\n      name\n    }\n    country\n    createdAt\n    deletedAt\n    department\n    description\n    employmentType\n    endDate\n    expiresAt\n    firstPublishedAt\n    id\n    payType\n    startDate\n    minSalary\n    maxSalary\n    status\n    title\n    totalApplications\n    updatedAt\n    workMode\n    workStartDate\n  }\n}\n    ",O=(e,t)=>(0,a.I)({queryKey:void 0===e?["UnappliedJobs"]:["UnappliedJobs",e],queryFn:u(M,e),...t});O.getKey=e=>void 0===e?["UnappliedJobs"]:["UnappliedJobs",e],O.fetcher=(e,t)=>u(M,e,t);let W="\n    query UpcomingInterview {\n  upcomingInterview {\n    id\n    scheduledAt\n    jobPostApplication {\n      jobPost {\n        applicationLimit\n        availibility\n        city\n        company {\n          name\n        }\n        country\n        createdAt\n        deletedAt\n        department\n        description\n        employmentType\n        endDate\n        expiresAt\n        firstPublishedAt\n        id\n        payType\n        startDate\n        minSalary\n        maxSalary\n        status\n        title\n        totalApplications\n        updatedAt\n        workMode\n        workStartDate\n      }\n    }\n  }\n}\n    ",z=(e,t)=>(0,a.I)({queryKey:void 0===e?["UpcomingInterview"]:["UpcomingInterview",e],queryFn:u(W,e),...t});z.getKey=e=>void 0===e?["UpcomingInterview"]:["UpcomingInterview",e],z.fetcher=(e,t)=>u(W,e,t);var H=n(44134).hp;function B(e,t){return t?H.from("".concat(e,":").concat(t)).toString("base64"):""}function G(e){var t;return e?null===(t=H.from(e,"base64").toString("ascii").split(":"))||void 0===t?void 0:t[1]:""}},40745:()=>{},41354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var r=n(95155),a=n(12115),o=n(35695),i=n(33764),s=n(50438),l=n(31530),c=n(74931),u=n(84477),d=n(87110),p=n(54581),m=n(3127),y=n(29709),g=n(22319);function v(){var e;let{id:t}=(0,o.useParams)(),[n,v]=(0,a.useState)([]),[b,h]=(0,a.useState)(!1),[f,w]=(0,a.useState)(!1),[A,S]=(0,a.useState)(!1),I=(0,a.useRef)(null),P=(0,a.useRef)([]),k=(0,a.useRef)(null),U=(0,a.useRef)([]),E=(0,a.useRef)(!1),T=(0,a.useRef)(null),R=(0,a.useRef)(null),K=(0,a.useRef)(null),x=(0,a.useRef)(null),F=(0,a.useRef)(null),C=(0,a.useRef)(null),J=(0,a.useRef)(null),j=(0,a.useRef)(!1),{data:N}=(0,g.LF)({id:(0,g.wc)("Interview",String(t))}),q=(0,o.useRouter)(),D=null==N?void 0:null===(e=N.interviews.edges[0])||void 0===e?void 0:e.node;console.log("Interview data:",D);let $=new i.l7({apiKey:"43b24f3a62744557bfdc6813f3211783"}),[_,L]=(0,a.useState)(!1),M=(0,a.useRef)(null),O=(0,a.useRef)([]);(0,a.useRef)(null);let{mutateAsync:W}=(0,g.FM)(),{mutateAsync:z}=(0,g._L)(),{mutateAsync:H}=(0,g.nF)(),B=(0,a.useRef)(null),G=(0,a.useRef)(null),V=(0,a.useRef)([]),Y=(0,a.useRef)(!1);(0,a.useEffect)(()=>{let e=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!0});x.current=e,F.current&&(F.current.srcObject=e,F.current.onloadedmetadata=()=>{var e;null===(e=F.current)||void 0===e||e.play()});let n=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9,opus"});M.current=n,O.current=[],n.ondataavailable=e=>{e.data.size>0&&(console.log("Received video chunk:",e.data.size),O.current.push(e.data))},n.start(1e3),L(!0),t()}catch(e){console.error("Error accessing camera:",e),l.Ay.error("Camera access denied. Please enable camera for this interview.")}},t=async()=>{if(!F.current||F.current.readyState<2){C.current=setTimeout(t,100);return}try{let e=await s.R(F.current,new s.ex).withFaceLandmarks();if(e.length>0){let t=e[0].landmarks.getNose()[3];n(t.x,F.current.videoWidth)}else r()}catch(e){console.error("Face detection error:",e)}C.current=setTimeout(t,300)},n=(e,t)=>{Math.abs(e-t/2)>.25*t?r():(J.current=null,(j.current||A)&&(j.current=!1,S(!1),l.Ay.dismiss()))},r=()=>{let e=Date.now();J.current?e-J.current>5e3&&!j.current&&(l.Ay.error("Please focus on the interview and look at the screen"),j.current=!0,S(!0)):J.current=e};return(async()=>{try{s.B0.tinyFaceDetector.loadFromUri("/models"),s.B0.faceLandmark68Net.loadFromUri("/models"),e()}catch(e){console.error("Error loading face detection models:",e)}})(),()=>{C.current&&clearTimeout(C.current),x.current&&x.current.getTracks().forEach(e=>e.stop())}},[]),(0,a.useEffect)(()=>{T.current=new Audio,T.current.onended=Q;let e=new WebSocket("wss://prototype-apriora.duckdns.org/ws/interview/".concat(t,"/"));return e.onopen=()=>console.log("✅ WebSocket connected"),e.onmessage=e=>{let n=JSON.parse(e.data);if("text_message"===n.type&&v(e=>[...e,{type:n.is_ai?"bot":"user",text:n.text}]),"tts_audio"===n.type){if(U.current.push({audio:n.audio_chunk,messageType:n.message_type}),"question"===n.message_type&&(R.current=n.message_type),"interview_complete"===n.message_type){let e=()=>{E.current||0!==U.current.length||(X(),q.push("/interview/".concat(t,"/completed")))},n=setInterval(()=>{E.current||0!==U.current.length||(clearInterval(n),e())},500);e()}E.current||Z()}},e.onclose=()=>console.log("❌ WebSocket disconnected"),k.current=e,()=>{X(),e.close()}},[t]),(0,a.useEffect)(()=>{let e=e=>{"Space"===e.code&&f&&et()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]);let Q=()=>{E.current=!1,U.current.length>0?Z():(R.current=null,ee())},X=async()=>{if(T.current&&(T.current.pause(),T.current.onended=null),et(),M.current&&_&&("recording"===M.current.state&&await ea(M.current,O),M.current.stop(),L(!1)),K.current&&clearTimeout(K.current),x.current&&x.current.getTracks().forEach(e=>e.stop()),J.current=null,j.current=!1,S(!1),l.Ay.dismiss(),O.current.length>0&&!Y.current){Y.current=!0;try{let e=await er(O.current);console.log("Uploaded video URL:",e)}catch(e){console.error("Error uploading video:",e)}finally{Y.current=!1,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(e=>{e.getTracks().forEach(e=>e.stop())}).catch(e=>{console.warn("Failed to force-stop media devices:",e)})}}O.current=[]},Z=()=>{if(0===U.current.length||E.current)return;let e=U.current.shift();e&&T.current&&(E.current=!0,T.current.src="data:audio/mp3;base64,".concat(e.audio),T.current.play().catch(e=>{console.error("Audio playback failed:",e),E.current=!1,Z()}))},ee=async()=>{try{if(f)return;let e=await navigator.mediaDevices.getUserMedia({audio:!0});x.current=e;let t=new MediaRecorder(e);I.current=t,P.current=[],t.ondataavailable=e=>{e.data.size>0&&(P.current.push(e.data),K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{et()},3e3))},t.onstop=async()=>{let e=new Blob(P.current,{type:"audio/wav"});await en(e),K.current&&clearTimeout(K.current)},t.start(250),w(!0)}catch(e){console.error("Error starting recording:",e),w(!1)}},et=()=>{I.current&&"inactive"!==I.current.state&&(I.current.stop(),w(!1)),x.current&&(x.current.getTracks().forEach(e=>e.stop()),x.current=null)},en=async e=>{h(!0);try{let t=new FileReader;t.onloadend=async()=>{var e;let n=t.result,r=await $.transcripts.transcribe({audio:n});if("error"===r.status){console.error("\uD83D\uDEA8 Transcription error:",r.error);return}let a=r.text;v(e=>[...e,{type:"user",text:a}]),(null===(e=k.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&k.current.send(JSON.stringify({response:a}))},t.readAsDataURL(e)}catch(e){console.error("Error processing audio:",e)}finally{h(!1)}},er=async e=>{try{console.log("Starting video upload...",{chunksCount:e.length});let n=new Blob(e,{type:"video/webm;codecs=vp9,opus"});if(console.log("Video blob size:",n.size),0===n.size)return console.warn("Empty video blob, skipping upload"),null;let{initiateUpload:{uploadId:r,key:a}}=await W({filename:"".concat(t,".webm"),contentType:"video/webm"});console.log("Upload initiated:",{uploadId:r,key:a}),B.current=r,G.current=a,V.current=[];let o=Math.ceil(n.size/5242880);console.log("Uploading in chunks:",{totalChunks:o});let i=[];for(let e=0;e<o;e++){let t=5242880*e,s=Math.min(t+5242880,n.size),l=n.slice(t,s),c=e+1;console.log("Uploading chunk ".concat(c,"/").concat(o));let{getUploadPartUrl:u}=await z({uploadId:r,partNumber:c,key:a}),d=fetch(u,{method:"PUT",body:l}).then(async e=>{if(!e.ok)throw Error("Failed to upload part ".concat(c));let t=e.headers.get("ETag");if(!t)throw Error("No ETag received for part ".concat(c));return{partNumber:c,etag:t}});i.push(d)}let s=await Promise.all(i);return s.sort((e,t)=>e.partNumber-t.partNumber),await H({uploadId:r,key:a,parts:s}),console.log("Video upload completed successfully"),"https://naxiora-interviews.s3.amazonaws.com/".concat(a)}catch(e){throw console.error("Error uploading video:",e),l.Ay.error("Failed to upload interview recording"),e}},ea=(e,t)=>new Promise(n=>{let r=a=>{a.data.size>0&&t.current.push(a.data),e.removeEventListener("dataavailable",r),n()};e.addEventListener("dataavailable",r),e.requestData()});return(0,r.jsxs)(p.default,{className:"w-screen p-6 flex gap-5 h-screen",style:{backgroundColor:"#101a25"},children:[(0,r.jsxs)(p.default,{className:"w-3/4",children:[(0,r.jsx)(c.InterviewHeader,{position:null==D?void 0:D.jobPostApplication.jobPost.title}),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(u.VideoFeed,{videoRef:F,isAway:A})}),(0,r.jsx)("div",{className:"flex justify-center mt-3",children:(0,r.jsxs)(m.default,{onClick:()=>{f&&et()},sx:{backgroundColor:f?"rgba(255, 0, 0, 0.2)":"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:f?"rgba(255, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"},borderRadius:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",width:"200px"},children:[(0,r.jsx)(y.default,{className:"text-white"}),f&&(0,r.jsx)("span",{className:"ml-2 text-white text-xs",children:"Stop Recording"})]})})]}),(0,r.jsx)(p.default,{className:"w-1/4",children:(0,r.jsx)(d.ChatTranscript,{messages:n,loading:b,isRecording:f,position:null==D?void 0:D.jobPostApplication.jobPost.title,company:null==D?void 0:D.jobPostApplication.jobPost.company.name})})]})}},90253:(e,t,n)=>{Promise.resolve().then(n.bind(n,41354))},97318:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[122,711,860,375,667,926,234,732,328,441,684,358],()=>t(90253)),_N_E=e.O()}]);