(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{18082:()=>{},22319:(e,t,n)=>{"use strict";n.d(t,{AG:()=>d,fi:()=>p,cr:()=>y,MO:()=>m,NH:()=>v,bC:()=>O,wc:()=>_,RB:()=>R,AY:()=>h,OD:()=>f,bE:()=>J,Br:()=>A,LF:()=>I,lI:()=>T,jb:()=>C,GF:()=>E,EL:()=>F,n6:()=>D});var r=n(5041),i=n(19373);class a extends Error{constructor(e="Validation Error",t=500,n={}){var r,i;super(e),this.name=this.constructor.name,this.status=t,this.message=e,n&&(this.meta=n),null===(r=(i=Error).captureStackTrace)||void 0===r||r.call(i,this,this.constructor)}}var o=n(58811),s=n(95120),c=n.n(s);let u=new o.l4("http://localhost:8000/graphql",{fetch:c(),credentials:"include"});function l(e,t,n){return async()=>u.request(e,t,n).catch(e=>{let{response:t}=e;if((null==t?void 0:t.status)===401)return{};throw new a(null==t?void 0:t.error,null==t?void 0:t.status,{response:t})})}var d=function(e){return e.FourWeeksNotice="FOUR_WEEKS_NOTICE",e.Immediate="IMMEDIATE",e.ThreeWeeksNotice="THREE_WEEKS_NOTICE",e.TwoWeeksNotice="TWO_WEEKS_NOTICE",e}({}),p=function(e){return e.Contract="CONTRACT",e.FullTime="FULL_TIME",e.PartTime="PART_TIME",e}({}),y=function(e){return e.Hourly="HOURLY",e.Unit="UNIT",e}({}),m=function(e){return e.Archived="ARCHIVED",e.Draft="DRAFT",e.Published="PUBLISHED",e}({}),v=function(e){return e.Hybrid="HYBRID",e.OnSite="ON_SITE",e.Remote="REMOTE",e}({});let b="\n    mutation CreateJobPostApplication($data: JobPostApplicationCreateInput!) {\n  createJobPostApplication(data: $data) {\n    ... on JobPostApplicationType {\n      id\n    }\n    ... on GraphQLErrorType {\n      message\n      code\n    }\n  }\n}\n    ",h=e=>(0,r.n)({mutationKey:["CreateJobPostApplication"],mutationFn:e=>l(b,e)(),...e});h.getKey=()=>["CreateJobPostApplication"],h.fetcher=(e,t)=>l(b,e,t);let g="\n    mutation CreateJobPost($data: JobPostCreateInput!) {\n  jobPostCreate(data: $data) {\n    id\n  }\n}\n    ",f=e=>(0,r.n)({mutationKey:["CreateJobPost"],mutationFn:e=>l(g,e)(),...e});f.getKey=()=>["CreateJobPost"],f.fetcher=(e,t)=>l(g,e,t);let w="\n    mutation getInterviewSumary($interviewId: UUID!) {\n  getSummary(interviewId: $interviewId) {\n    summary\n    communication\n    cultureFit\n    curiosity\n    experience\n    overallScore\n    problemSolving\n    technicalAbility\n  }\n}\n    ",A=e=>(0,r.n)({mutationKey:["getInterviewSumary"],mutationFn:e=>l(w,e)(),...e});A.getKey=()=>["getInterviewSumary"],A.fetcher=(e,t)=>l(w,e,t);let P="\n    query Interview($id: GlobalID!) {\n  interviews(filters: {id: $id}) {\n    edges {\n      node {\n        id\n        questions {\n          question\n        }\n        user {\n          name\n        }\n        jobPostApplication {\n          jobPost {\n            company {\n              name\n            }\n            title\n          }\n        }\n      }\n    }\n  }\n}\n    ",I=(e,t)=>(0,i.I)({queryKey:["Interview",e],queryFn:l(P,e),...t});I.getKey=e=>["Interview",e],I.fetcher=(e,t)=>l(P,e,t);let S="\n    query JobSeekerKpis {\n  jobSeekerKpis {\n    followUps\n    followUpsChangePercent\n    interviewsAttended\n    interviewsAttendedChangePercent\n    jobsApplied\n    jobsAppliedChangePercent\n    pendingInterviews\n    pendingInterviewsChangePercent\n  }\n}\n    ",T=(e,t)=>(0,i.I)({queryKey:void 0===e?["JobSeekerKpis"]:["JobSeekerKpis",e],queryFn:l(S,e),...t});T.getKey=e=>void 0===e?["JobSeekerKpis"]:["JobSeekerKpis",e],T.fetcher=(e,t)=>l(S,e,t);let k="\n    query RecruiterKpis {\n  recruiterKpis {\n    interviewed\n    interviewedChangePercent\n    jobsPosted\n    jobsPostedChangePercent\n    totalApplicants\n    totalApplicantsChangePercent\n  }\n}\n    ",E=(e,t)=>(0,i.I)({queryKey:void 0===e?["RecruiterKpis"]:["RecruiterKpis",e],queryFn:l(k,e),...t});E.getKey=e=>void 0===e?["RecruiterKpis"]:["RecruiterKpis",e],E.fetcher=(e,t)=>l(k,e,t);let K="\n    query AppliedJobs {\n  appliedJobPosts {\n    jobPost {\n      availibility\n      applicationLimit\n      city\n      country\n      company {\n        name\n      }\n      workStartDate\n      workMode\n      updatedAt\n      totalApplications\n      title\n      status\n      startDate\n      salary\n      payType\n      id\n      firstPublishedAt\n      expiresAt\n      endDate\n      employmentType\n      description\n      department\n      deletedAt\n      createdAt\n    }\n    interview {\n      scheduledAt\n      user {\n        name\n      }\n    }\n  }\n}\n    ",R=(e,t)=>(0,i.I)({queryKey:void 0===e?["AppliedJobs"]:["AppliedJobs",e],queryFn:l(K,e),...t});R.getKey=e=>void 0===e?["AppliedJobs"]:["AppliedJobs",e],R.fetcher=(e,t)=>l(K,e,t);let x="\n    query getAllSummaries {\n  summary {\n    summary {\n      summary\n    }\n    jobPost {\n      title\n    }\n    user {\n      email\n      lastName\n      firstName\n    }\n    interview {\n      scheduledAt\n    }\n  }\n}\n    ",J=(e,t)=>(0,i.I)({queryKey:void 0===e?["getAllSummaries"]:["getAllSummaries",e],queryFn:l(x,e),...t});J.getKey=e=>void 0===e?["getAllSummaries"]:["getAllSummaries",e],J.fetcher=(e,t)=>l(x,e,t);let j="\n    query JobsPosts {\n  jobPosts {\n    applicationLimit\n    availibility\n    city\n    company {\n      name\n    }\n    country\n    createdAt\n    deletedAt\n    department\n    description\n    employmentType\n    endDate\n    expiresAt\n    firstPublishedAt\n    id\n    payType\n    startDate\n    salary\n    status\n    title\n    totalApplications\n    updatedAt\n    workMode\n    workStartDate\n  }\n}\n    ",C=(e,t)=>(0,i.I)({queryKey:void 0===e?["JobsPosts"]:["JobsPosts",e],queryFn:l(j,e),...t});C.getKey=e=>void 0===e?["JobsPosts"]:["JobsPosts",e],C.fetcher=(e,t)=>l(j,e,t);let q="\n    query UnappliedJobs {\n  unappliedJobPosts {\n    applicationLimit\n    availibility\n    city\n    company {\n      name\n    }\n    country\n    createdAt\n    deletedAt\n    department\n    description\n    employmentType\n    endDate\n    expiresAt\n    firstPublishedAt\n    id\n    payType\n    startDate\n    salary\n    status\n    title\n    totalApplications\n    updatedAt\n    workMode\n    workStartDate\n  }\n}\n    ",F=(e,t)=>(0,i.I)({queryKey:void 0===e?["UnappliedJobs"]:["UnappliedJobs",e],queryFn:l(q,e),...t});F.getKey=e=>void 0===e?["UnappliedJobs"]:["UnappliedJobs",e],F.fetcher=(e,t)=>l(q,e,t);let N="\n    query UpcomingInterview {\n  upcomingInterview {\n    id\n    scheduledAt\n    jobPostApplication {\n      jobPost {\n        applicationLimit\n        availibility\n        city\n        company {\n          name\n        }\n        country\n        createdAt\n        deletedAt\n        department\n        description\n        employmentType\n        endDate\n        expiresAt\n        firstPublishedAt\n        id\n        payType\n        startDate\n        salary\n        status\n        title\n        totalApplications\n        updatedAt\n        workMode\n        workStartDate\n      }\n    }\n  }\n}\n    ",D=(e,t)=>(0,i.I)({queryKey:void 0===e?["UpcomingInterview"]:["UpcomingInterview",e],queryFn:l(N,e),...t});D.getKey=e=>void 0===e?["UpcomingInterview"]:["UpcomingInterview",e],D.fetcher=(e,t)=>l(N,e,t);var U=n(44134).hp;function _(e,t){return t?U.from("".concat(e,":").concat(t)).toString("base64"):""}function O(e){var t;return e?null===(t=U.from(e,"base64").toString("ascii").split(":"))||void 0===t?void 0:t[1]:""}},40745:()=>{},41354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n(95155),i=n(12115),a=n(35695),o=n(33764),s=n(50438),c=n(31530),u=n(74931),l=n(84477),d=n(87110),p=n(54581),y=n(3127),m=n(29709),v=n(22319);function b(){var e;let{id:t}=(0,a.useParams)(),[n,b]=(0,i.useState)([]),[h,g]=(0,i.useState)(!1),[f,w]=(0,i.useState)(!1),[A,P]=(0,i.useState)(!1),I=(0,i.useRef)(null),S=(0,i.useRef)([]),T=(0,i.useRef)(null),k=(0,i.useRef)([]),E=(0,i.useRef)(!1),K=(0,i.useRef)(null),R=(0,i.useRef)(null),x=(0,i.useRef)(null),J=(0,i.useRef)(null),j=(0,i.useRef)(null),C=(0,i.useRef)(null),q=(0,i.useRef)(null),F=(0,i.useRef)(!1),{data:N}=(0,v.LF)({id:(0,v.wc)("Interview",String(t))}),D=(0,a.useRouter)(),U=null==N?void 0:null===(e=N.interviews.edges[0])||void 0===e?void 0:e.node;console.log("Interview data:",U);let _=new o.l7({apiKey:"43b24f3a62744557bfdc6813f3211783"});(0,i.useEffect)(()=>{let e=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});J.current=e,j.current&&(j.current.srcObject=e,j.current.onloadedmetadata=()=>{var e;null===(e=j.current)||void 0===e||e.play()}),t()}catch(e){console.error("Error accessing camera:",e),c.Ay.error("Camera access denied. Please enable camera for this interview.")}},t=async()=>{if(!j.current||j.current.readyState<2){C.current=setTimeout(t,100);return}try{let e=await s.R(j.current,new s.ex).withFaceLandmarks();if(e.length>0){let t=e[0].landmarks.getNose()[3];n(t.x,j.current.videoWidth)}else r()}catch(e){console.error("Face detection error:",e)}C.current=setTimeout(t,300)},n=(e,t)=>{Math.abs(e-t/2)>.25*t?r():(q.current=null,(F.current||A)&&(F.current=!1,P(!1),c.Ay.dismiss()))},r=()=>{let e=Date.now();q.current?e-q.current>5e3&&!F.current&&(c.Ay.error("Please focus on the interview and look at the screen"),F.current=!0,P(!0)):q.current=e};return(async()=>{try{s.B0.tinyFaceDetector.loadFromUri("/models"),s.B0.faceLandmark68Net.loadFromUri("/models"),e()}catch(e){console.error("Error loading face detection models:",e)}})(),()=>{C.current&&clearTimeout(C.current),J.current&&J.current.getTracks().forEach(e=>e.stop())}},[]),(0,i.useEffect)(()=>{K.current=new Audio,K.current.onended=O;let e=new WebSocket("wss://prototype-apriora.duckdns.org/ws/interview/".concat(t,"/"));return e.onopen=()=>console.log("✅ WebSocket connected"),e.onmessage=e=>{let n=JSON.parse(e.data);if("text_message"===n.type&&b(e=>[...e,{type:n.is_ai?"bot":"user",text:n.text}]),"tts_audio"===n.type){if(k.current.push({audio:n.audio_chunk,messageType:n.message_type}),"question"===n.message_type&&(R.current=n.message_type),"interview_complete"===n.message_type){let e=()=>{E.current||0!==k.current.length||(L(),D.push("/interview/".concat(t,"/completed")))},n=setInterval(()=>{E.current||0!==k.current.length||(clearInterval(n),e())},500);e()}E.current||M()}},e.onclose=()=>console.log("❌ WebSocket disconnected"),T.current=e,()=>{L(),e.close()}},[t]),(0,i.useEffect)(()=>{let e=e=>{"Space"===e.code&&f&&H()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]);let O=()=>{E.current=!1,k.current.length>0?M():(R.current=null,W())},L=()=>{K.current&&(K.current.pause(),K.current.onended=null),H(),x.current&&clearTimeout(x.current),J.current&&J.current.getTracks().forEach(e=>e.stop()),q.current=null,F.current=!1,P(!1),c.Ay.dismiss()},M=()=>{if(0===k.current.length||E.current)return;let e=k.current.shift();e&&K.current&&(E.current=!0,K.current.src="data:audio/mp3;base64,".concat(e.audio),K.current.play().catch(e=>{console.error("Audio playback failed:",e),E.current=!1,M()}))},W=async()=>{try{if(f)return;let e=await navigator.mediaDevices.getUserMedia({audio:!0});J.current=e;let t=new MediaRecorder(e);I.current=t,S.current=[],t.ondataavailable=e=>{e.data.size>0&&(S.current.push(e.data),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{H()},3e3))},t.onstop=async()=>{let e=new Blob(S.current,{type:"audio/wav"});await $(e),x.current&&clearTimeout(x.current)},t.start(250),w(!0)}catch(e){console.error("Error starting recording:",e),w(!1)}},H=()=>{I.current&&"inactive"!==I.current.state&&(I.current.stop(),w(!1)),J.current&&(J.current.getTracks().forEach(e=>e.stop()),J.current=null)},$=async e=>{g(!0);try{let t=new FileReader;t.onloadend=async()=>{var e;let n=t.result,r=await _.transcripts.transcribe({audio:n});if("error"===r.status){console.error("\uD83D\uDEA8 Transcription error:",r.error);return}let i=r.text;b(e=>[...e,{type:"user",text:i}]),(null===(e=T.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&T.current.send(JSON.stringify({response:i}))},t.readAsDataURL(e)}catch(e){console.error("Error processing audio:",e)}finally{g(!1)}};return(0,r.jsxs)(p.default,{className:"w-screen p-6 flex gap-5 h-screen",style:{backgroundColor:"#101a25"},children:[(0,r.jsxs)(p.default,{className:"w-3/4",children:[(0,r.jsx)(u.InterviewHeader,{position:null==U?void 0:U.jobPostApplication.jobPost.title}),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(l.VideoFeed,{videoRef:j,isAway:A})}),(0,r.jsx)("div",{className:"flex justify-center mt-3",children:(0,r.jsxs)(y.default,{onClick:()=>{f&&H()},sx:{backgroundColor:f?"rgba(255, 0, 0, 0.2)":"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:f?"rgba(255, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"},borderRadius:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",width:"200px"},children:[(0,r.jsx)(m.default,{className:"text-white"}),f&&(0,r.jsx)("span",{className:"ml-2 text-white text-xs",children:"Stop Recording"})]})})]}),(0,r.jsx)(p.default,{className:"w-1/4",children:(0,r.jsx)(d.ChatTranscript,{messages:n,loading:h,isRecording:f,position:null==U?void 0:U.jobPostApplication.jobPost.title,company:null==U?void 0:U.jobPostApplication.jobPost.company.name})})]})}},90253:(e,t,n)=>{Promise.resolve().then(n.bind(n,41354))},97318:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[122,711,860,375,667,926,234,732,328,441,684,358],()=>t(90253)),_N_E=e.O()}]);